<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>src/http/ngx_http_script.c - Nginx 1.11.2</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>src/http/ngx_http_script.c - Nginx 1.11.2</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L32">ngx_http_script_exit_code</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L108">ngx_http_compile_complex_value</a></li>
<li><a href="#L58">ngx_http_complex_value</a></li>
<li><a href="#L860">ngx_http_script_add_args_code</a></li>
<li><a href="#L1168">ngx_http_script_add_capture_code</a></li>
<li><a href="#L656">ngx_http_script_add_code</a></li>
<li><a href="#L680">ngx_http_script_add_copy_code</a></li>
<li><a href="#L1283">ngx_http_script_add_full_name_code</a></li>
<li><a href="#L759">ngx_http_script_add_var_code</a></li>
<li><a href="#L1377">ngx_http_script_break_code</a></li>
<li><a href="#L333">ngx_http_script_compile</a></li>
<li><a href="#L1606">ngx_http_script_complex_value_code</a></li>
<li><a href="#L1241">ngx_http_script_copy_capture_code</a></li>
<li><a href="#L1203">ngx_http_script_copy_capture_len_code</a></li>
<li><a href="#L736">ngx_http_script_copy_code</a></li>
<li><a href="#L723">ngx_http_script_copy_len_code</a></li>
<li><a href="#L828">ngx_http_script_copy_var_code</a></li>
<li><a href="#L803">ngx_http_script_copy_var_len_code</a></li>
<li><a href="#L597">ngx_http_script_done</a></li>
<li><a href="#L1415">ngx_http_script_equal_code</a></li>
<li><a href="#L1471">ngx_http_script_file_code</a></li>
<li><a href="#L36">ngx_http_script_flush_complex_value</a></li>
<li><a href="#L535">ngx_http_script_flush_no_cacheable_variables</a></li>
<li><a href="#L1326">ngx_http_script_full_name_code</a></li>
<li><a href="#L1312">ngx_http_script_full_name_len_code</a></li>
<li><a href="#L1386">ngx_http_script_if_code</a></li>
<li><a href="#L553">ngx_http_script_init_arrays</a></li>
<li><a href="#L883">ngx_http_script_mark_args_code</a></li>
<li><a href="#L1751">ngx_http_script_nop_code</a></li>
<li><a href="#L1443">ngx_http_script_not_equal_code</a></li>
<li><a href="#L1064">ngx_http_script_regex_end_code</a></li>
<li><a href="#L907">ngx_http_script_regex_start_code</a></li>
<li><a href="#L1356">ngx_http_script_return_code</a></li>
<li><a href="#L486">ngx_http_script_run</a></li>
<li><a href="#L1667">ngx_http_script_set_var_code</a></li>
<li><a href="#L893">ngx_http_script_start_args_code</a></li>
<li><a href="#L642">ngx_http_script_start_code</a></li>
<li><a href="#L1648">ngx_http_script_value_code</a></li>
<li><a href="#L1721">ngx_http_script_var_code</a></li>
<li><a href="#L1703">ngx_http_script_var_set_handler_code</a></li>
<li><a href="#L318">ngx_http_script_variables_count</a></li>
<li><a href="#L212">ngx_http_set_complex_value_slot</a></li>
<li><a href="#L275">ngx_http_set_predicate_slot</a></li>
<li><a href="#L248">ngx_http_test_predicates</a></li>
</ul>
 <h2>Macros defined</h2>
 <ul class="toc">
<li><a href="#L30">ngx_http_script_exit</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_http.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L553" title="src/http/ngx_http_script.c:553">ngx_http_script_init_arrays</a>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L597" title="src/http/ngx_http_script.c:597">ngx_http_script_done</a>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L680" title="src/http/ngx_http_script.c:680">ngx_http_script_add_copy_code</a>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *value, <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> last);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L759" title="src/http/ngx_http_script.c:759">ngx_http_script_add_var_code</a>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *name);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L860" title="src/http/ngx_http_script.c:860">ngx_http_script_add_args_code</a>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc);<br/></li>
<li><span class="PreProc">#if (NGX_PCRE)<br/></li>
<li></span><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L1168" title="src/http/ngx_http_script.c:1168">ngx_http_script_add_capture_code</a>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> n);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li>&nbsp; &nbsp; <a href="#L1283" title="src/http/ngx_http_script.c:1283">ngx_http_script_add_full_name_code</a>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc);<br/></li>
<li><span class="Type">static</span> <span class="Type">size_t</span> <a href="#L1312" title="src/http/ngx_http_script.c:1312">ngx_http_script_full_name_len_code</a>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L1326" title="src/http/ngx_http_script.c:1326">ngx_http_script_full_name_code</a>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L30">&#x200c;</a><span class="PreProc">#define <span class="linkable">ngx_http_script_exit</span>&nbsp; (u_char *) &amp;<a href="#L32" title="src/http/ngx_http_script.c:32">ngx_http_script_exit_code</a><br/></li>
<li></span><br/></li>
<li><a id="L32">&#x200c;</a><span class="Type">static</span> <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> <span class="linkable">ngx_http_script_exit_code</span> = (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L36">&#x200c;</a></span><span class="linkable">ngx_http_script_flush_complex_value</span>(<a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a> *r,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a> *val)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> *index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; index = val-&gt;flushes;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (index) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*index != (<a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>) -<span class="Constant">1</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;variables[*index].no_cacheable) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;variables[*index].valid = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;variables[*index].not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L58">&#x200c;</a><span class="linkable">ngx_http_complex_value</span>(<a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a> *r, <a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a> *val,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *value)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a>&nbsp; &nbsp; &nbsp;&nbsp; code;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a>&nbsp;&nbsp; lcode;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>&nbsp; &nbsp; &nbsp; e;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (val-&gt;lengths == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *value = val-&gt;value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L36" title="src/http/ngx_http_script.c:36">ngx_http_script_flush_complex_value</a>(r, val);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;e, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e.ip = val-&gt;lengths;<br/></li>
<li>&nbsp; &nbsp; e.request = r;<br/></li>
<li>&nbsp; &nbsp; e.flushed = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> *) e.ip) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lcode = *(<a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a> *) e.ip;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += lcode(&amp;e);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value-&gt;len = len;<br/></li>
<li>&nbsp; &nbsp; value-&gt;data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(r-&gt;pool, len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value-&gt;data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e.ip = val-&gt;values;<br/></li>
<li>&nbsp; &nbsp; e.pos = value-&gt;data;<br/></li>
<li>&nbsp; &nbsp; e.buf = *value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> *) e.ip) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code = *(<a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a> *) e.ip;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code((<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *) &amp;e);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *value = e.buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L108">&#x200c;</a><span class="linkable">ngx_http_compile_complex_value</span>(<a href="ngx_http_script.h.html#L82" title="src/http/ngx_http_script.h:82">ngx_http_compile_complex_value_t</a> *ccv)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i, n, nv, nc;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_array.h.html#L22" title="src/core/ngx_array.h:22">ngx_array_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; flushes, lengths, values, *pf, *pl, *pv;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a>&nbsp;&nbsp; sc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = ccv-&gt;value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; nv = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; nc = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; v-&gt;len; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;data[i] == <span class="Constant">'$'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;data[i + <span class="Constant">1</span>] &gt;= <span class="Constant">'1'</span> &amp;&amp; v-&gt;data[i + <span class="Constant">1</span>] &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nc++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nv++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> ((v-&gt;len == <span class="Constant">0</span> || v-&gt;data[<span class="Constant">0</span>] != <span class="Constant">'$'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (ccv-&gt;conf_prefix || ccv-&gt;root_prefix))<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_conf_file.c.html#L845" title="src/core/ngx_conf_file.c:845">ngx_conf_full_name</a>(ccv-&gt;cf-&gt;cycle, v, ccv-&gt;conf_prefix) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccv-&gt;conf_prefix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccv-&gt;root_prefix = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccv-&gt;complex_value-&gt;value = *v;<br/></li>
<li>&nbsp; &nbsp; ccv-&gt;complex_value-&gt;flushes = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; ccv-&gt;complex_value-&gt;lengths = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; ccv-&gt;complex_value-&gt;values = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (nv == <span class="Constant">0</span> &amp;&amp; nc == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = nv + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_array.h.html#L32" title="src/core/ngx_array.h:32">ngx_array_init</a>(&amp;flushes, ccv-&gt;cf-&gt;pool, n, <span class="Statement">sizeof</span>(<a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = nv * (<span class="Constant">2</span> * <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_array.h.html#L32" title="src/core/ngx_array.h:32">ngx_array_init</a>(&amp;lengths, ccv-&gt;cf-&gt;pool, n, <span class="Constant">1</span>) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = (nv * (<span class="Constant">2</span> * <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + v-&gt;len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp; ~(<span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_array.h.html#L32" title="src/core/ngx_array.h:32">ngx_array_init</a>(&amp;values, ccv-&gt;cf-&gt;pool, n, <span class="Constant">1</span>) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pf = &amp;flushes;<br/></li>
<li>&nbsp; &nbsp; pl = &amp;lengths;<br/></li>
<li>&nbsp; &nbsp; pv = &amp;values;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;sc, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc.cf = ccv-&gt;cf;<br/></li>
<li>&nbsp; &nbsp; sc.source = v;<br/></li>
<li>&nbsp; &nbsp; sc.flushes = &amp;pf;<br/></li>
<li>&nbsp; &nbsp; sc.lengths = &amp;pl;<br/></li>
<li>&nbsp; &nbsp; sc.values = &amp;pv;<br/></li>
<li>&nbsp; &nbsp; sc.complete_lengths = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; sc.complete_values = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; sc.zero = ccv-&gt;zero;<br/></li>
<li>&nbsp; &nbsp; sc.conf_prefix = ccv-&gt;conf_prefix;<br/></li>
<li>&nbsp; &nbsp; sc.root_prefix = ccv-&gt;root_prefix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L333" title="src/http/ngx_http_script.c:333">ngx_http_script_compile</a>(&amp;sc) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (flushes.nelts) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccv-&gt;complex_value-&gt;flushes = flushes.elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccv-&gt;complex_value-&gt;flushes[flushes.nelts] = (<a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>) -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccv-&gt;complex_value-&gt;lengths = lengths.elts;<br/></li>
<li>&nbsp; &nbsp; ccv-&gt;complex_value-&gt;values = values.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">char</span> *<br/></li>
<li><a id="L212">&#x200c;</a><span class="linkable">ngx_http_set_complex_value_slot</span>(<a href="../core/ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="../core/ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; *p = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; **cv;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L82" title="src/http/ngx_http_script.h:82">ngx_http_compile_complex_value_t</a>&nbsp; &nbsp; ccv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cv = (<a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a> **) (p + cmd-&gt;offset);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*cv != <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;duplicate&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *cv = <a href="../core/ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(cf-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*cv == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;ccv, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L82" title="src/http/ngx_http_script.h:82">ngx_http_compile_complex_value_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccv.cf = cf;<br/></li>
<li>&nbsp; &nbsp; ccv.value = &amp;value[<span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; ccv.complex_value = *cv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L108" title="src/http/ngx_http_script.c:108">ngx_http_compile_complex_value</a>(&amp;ccv) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L248">&#x200c;</a><span class="linkable">ngx_http_test_predicates</span>(<a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a> *r, <a href="../core/ngx_array.h.html#L22" title="src/core/ngx_array.h:22">ngx_array_t</a> *predicates)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; val;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a>&nbsp; *cv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (predicates == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cv = predicates-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; predicates-&gt;nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L58" title="src/http/ngx_http_script.c:58">ngx_http_complex_value</a>(r, &amp;cv[i], &amp;val) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (val.len &amp;&amp; (val.len != <span class="Constant">1</span> || val.data[<span class="Constant">0</span>] != <span class="Constant">'0'</span>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L41" title="src/core/ngx_core.h:41">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">char</span> *<br/></li>
<li><a id="L275">&#x200c;</a><span class="linkable">ngx_http_set_predicate_slot</span>(<a href="../core/ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="../core/ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; *p = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_array.h.html#L22" title="src/core/ngx_array.h:22">ngx_array_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; **a;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *cv;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L82" title="src/http/ngx_http_script.h:82">ngx_http_compile_complex_value_t</a>&nbsp; &nbsp; ccv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; a = (<a href="../core/ngx_array.h.html#L22" title="src/core/ngx_array.h:22">ngx_array_t</a> **) (p + cmd-&gt;offset);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*a == <a href="../core/ngx_conf_file.h.html#L58" title="src/core/ngx_conf_file.h:58">NGX_CONF_UNSET_PTR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *a = <a href="../core/ngx_array.c.html#L13" title="src/core/ngx_array.c:13">ngx_array_create</a>(cf-&gt;pool, <span class="Constant">1</span>, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L71" title="src/http/ngx_http_script.h:71">ngx_http_complex_value_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*a == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt; cf-&gt;args-&gt;nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cv = <a href="../core/ngx_array.c.html#L48" title="src/core/ngx_array.c:48">ngx_array_push</a>(*a);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cv == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;ccv, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L82" title="src/http/ngx_http_script.h:82">ngx_http_compile_complex_value_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccv.cf = cf;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccv.value = &amp;value[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccv.complex_value = cv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L108" title="src/http/ngx_http_script.c:108">ngx_http_compile_complex_value</a>(&amp;ccv) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a><br/></li>
<li><a id="L318">&#x200c;</a><span class="linkable">ngx_http_script_variables_count</span>(<a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *value)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; i, n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (n = <span class="Constant">0</span>, i = <span class="Constant">0</span>; i &lt; value-&gt;len; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (value-&gt;data[i] == <span class="Constant">'$'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> n;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L333">&#x200c;</a><span class="linkable">ngx_http_script_compile</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp;&nbsp; ch;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; name;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; i, bracket;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L553" title="src/http/ngx_http_script.c:553">ngx_http_script_init_arrays</a>(sc) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; sc-&gt;source-&gt;len; <span class="Comment">/* void */</span> ) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; name.len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;source-&gt;data[i] == <span class="Constant">'$'</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (++i == sc-&gt;source-&gt;len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid_variable;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_PCRE)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;source-&gt;data[i] &gt;= <span class="Constant">'1'</span> &amp;&amp; sc-&gt;source-&gt;data[i] &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = sc-&gt;source-&gt;data[i] - <span class="Constant">'0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;captures_mask &amp; (<span class="Constant">1</span> &lt;&lt; n)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;dup_capture = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;captures_mask |= <span class="Constant">1</span> &lt;&lt; n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L1168" title="src/http/ngx_http_script.c:1168">ngx_http_script_add_capture_code</a>(sc, n) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;source-&gt;data[i] == <span class="Constant">'{'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bracket = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (++i == sc-&gt;source-&gt;len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid_variable;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name.data = &amp;sc-&gt;source-&gt;data[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bracket = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name.data = &amp;sc-&gt;source-&gt;data[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> ( <span class="Comment">/* void */</span> ; i &lt; sc-&gt;source-&gt;len; i++, name.len++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = sc-&gt;source-&gt;data[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'}'</span> &amp;&amp; bracket) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bracket = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((ch &gt;= <span class="Constant">'A'</span> &amp;&amp; ch &lt;= <span class="Constant">'Z'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (ch &gt;= <span class="Constant">'a'</span> &amp;&amp; ch &lt;= <span class="Constant">'z'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (ch &gt;= <span class="Constant">'0'</span> &amp;&amp; ch &lt;= <span class="Constant">'9'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || ch == <span class="Constant">'_'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bracket) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, sc-&gt;cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;the closing bracket in </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant"> &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;variable is missing&quot;</span>, &amp;name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (name.len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> invalid_variable;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;variables++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L759" title="src/http/ngx_http_script.c:759">ngx_http_script_add_var_code</a>(sc, &amp;name) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;source-&gt;data[i] == <span class="Constant">'?'</span> &amp;&amp; sc-&gt;compile_args) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;args = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;compile_args = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L860" title="src/http/ngx_http_script.c:860">ngx_http_script_add_args_code</a>(sc) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; name.data = &amp;sc-&gt;source-&gt;data[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (i &lt; sc-&gt;source-&gt;len) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;source-&gt;data[i] == <span class="Constant">'$'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;source-&gt;data[i] == <span class="Constant">'?'</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;args = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;compile_args) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name.len++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;size += name.len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L680" title="src/http/ngx_http_script.c:680">ngx_http_script_add_copy_code</a>(sc, &amp;name, (i == sc-&gt;source-&gt;len))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L597" title="src/http/ngx_http_script.c:597">ngx_http_script_done</a>(sc);<br/></li>
<li><br/></li>
<li><span class="Statement">invalid_variable</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, sc-&gt;cf, <span class="Constant">0</span>, <span class="Constant">&quot;invalid variable name&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L486">&#x200c;</a><span class="linkable">ngx_http_script_run</span>(<a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a> *r, <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *value,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *code_lengths, <span class="Type">size_t</span> len, <span class="Type">void</span> *code_values)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a>&nbsp; &nbsp; &nbsp;&nbsp; code;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a>&nbsp;&nbsp; lcode;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>&nbsp; &nbsp; &nbsp; e;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L178" title="src/http/ngx_http_core_module.h:178">ngx_http_core_main_conf_t</a>&nbsp; &nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_http_config.h.html#L55" title="src/http/ngx_http_config.h:55">ngx_http_get_module_main_conf</a>(r, <a href="ngx_http_core_module.c.html#L781" title="src/http/ngx_http_core_module.c:781">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cmcf-&gt;variables.nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;variables[i].no_cacheable) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;variables[i].valid = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;variables[i].not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;e, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e.ip = code_lengths;<br/></li>
<li>&nbsp; &nbsp; e.request = r;<br/></li>
<li>&nbsp; &nbsp; e.flushed = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> *) e.ip) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lcode = *(<a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a> *) e.ip;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len += lcode(&amp;e);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value-&gt;len = len;<br/></li>
<li>&nbsp; &nbsp; value-&gt;data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(r-&gt;pool, len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value-&gt;data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e.ip = code_values;<br/></li>
<li>&nbsp; &nbsp; e.pos = value-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> *) e.ip) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code = *(<a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a> *) e.ip;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code((<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *) &amp;e);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> e.pos;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L535">&#x200c;</a></span><span class="linkable">ngx_http_script_flush_no_cacheable_variables</span>(<a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a> *r,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_array.h.html#L22" title="src/core/ngx_array.h:22">ngx_array_t</a> *indices)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; n, *index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (indices) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; index = indices-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (n = <span class="Constant">0</span>; n &lt; indices-&gt;nelts; n++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;variables[index[n]].no_cacheable) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;variables[index[n]].valid = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;variables[index[n]].not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L553">&#x200c;</a><span class="linkable">ngx_http_script_init_arrays</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;flushes &amp;&amp; *sc-&gt;flushes == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = sc-&gt;variables ? sc-&gt;variables : <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *sc-&gt;flushes = <a href="../core/ngx_array.c.html#L13" title="src/core/ngx_array.c:13">ngx_array_create</a>(sc-&gt;cf-&gt;pool, n, <span class="Statement">sizeof</span>(<a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*sc-&gt;flushes == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*sc-&gt;lengths == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = sc-&gt;variables * (<span class="Constant">2</span> * <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *sc-&gt;lengths = <a href="../core/ngx_array.c.html#L13" title="src/core/ngx_array.c:13">ngx_array_create</a>(sc-&gt;cf-&gt;pool, n, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*sc-&gt;lengths == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*sc-&gt;values == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = (sc-&gt;variables * (<span class="Constant">2</span> * <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + sc-&gt;source-&gt;len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp; ~(<span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *sc-&gt;values = <a href="../core/ngx_array.c.html#L13" title="src/core/ngx_array.c:13">ngx_array_create</a>(sc-&gt;cf-&gt;pool, n, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*sc-&gt;values == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sc-&gt;variables = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L597">&#x200c;</a><span class="linkable">ngx_http_script_done</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; zero;<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>&nbsp;&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;zero) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; zero.len = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; zero.data = (u_char *) <span class="Constant">&quot;</span><span class="Special">\0</span><span class="Constant">&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L680" title="src/http/ngx_http_script.c:680">ngx_http_script_add_copy_code</a>(sc, &amp;zero, <span class="Constant">0</span>) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;conf_prefix || sc-&gt;root_prefix) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L1283" title="src/http/ngx_http_script.c:1283">ngx_http_script_add_full_name_code</a>(sc) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;complete_lengths) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;lengths, <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>), <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *code = (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;complete_values) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;values, <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;sc-&gt;<a href="../core/nginx.c.html#L187" title="src/core/nginx.c:187">main</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *code = (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void</span> *<br/></li>
<li><a id="L642">&#x200c;</a><span class="linkable">ngx_http_script_start_code</span>(<a href="../core/ngx_core.h.html#L18" title="src/core/ngx_core.h:18">ngx_pool_t</a> *pool, <a href="../core/ngx_array.h.html#L22" title="src/core/ngx_array.h:22">ngx_array_t</a> **codes, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (*codes == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *codes = <a href="../core/ngx_array.c.html#L13" title="src/core/ngx_array.c:13">ngx_array_create</a>(pool, <span class="Constant">256</span>, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*codes == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_array.c.html#L95" title="src/core/ngx_array.c:95">ngx_array_push_n</a>(*codes, size);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void</span> *<br/></li>
<li><a id="L656">&#x200c;</a><span class="linkable">ngx_http_script_add_code</span>(<a href="../core/ngx_array.h.html#L22" title="src/core/ngx_array.h:22">ngx_array_t</a> *codes, <span class="Type">size_t</span> size, <span class="Type">void</span> *code)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *elts, **p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; *new;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; elts = codes-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; new = <a href="../core/ngx_array.c.html#L95" title="src/core/ngx_array.c:95">ngx_array_push_n</a>(codes, size);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (new == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (elts != codes-&gt;elts) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = code;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p += (u_char *) codes-&gt;elts - elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> new;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L680">&#x200c;</a><span class="linkable">ngx_http_script_add_copy_code</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc, <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *value,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> last)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size, len, zero;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; zero = (sc-&gt;zero &amp;&amp; last);<br/></li>
<li>&nbsp; &nbsp; len = value-&gt;len + zero;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;lengths,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>), <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = (<a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a>) <a href="#L723" title="src/http/ngx_http_script.c:723">ngx_http_script_copy_len_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;len = len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = (<span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>) + len + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp; ~(<span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;values, size, &amp;sc-&gt;<a href="../core/nginx.c.html#L187" title="src/core/nginx.c:187">main</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = <a href="#L736" title="src/http/ngx_http_script.c:736">ngx_http_script_copy_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;len = len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_string.h.html#L93" title="src/core/ngx_string.h:93">ngx_cpymem</a>((u_char *) code + <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; value-&gt;data, value-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (zero) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;zero = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L723">&#x200c;</a></span><span class="linkable">ngx_http_script_copy_len_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> code-&gt;len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L736">&#x200c;</a></span><span class="linkable">ngx_http_script_copy_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = e-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!e-&gt;skip) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;pos = <a href="../core/ngx_string.h.html#L116" title="src/core/ngx_string.h:116">ngx_copy</a>(p, e-&gt;ip + <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; code-&gt;len);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L92" title="src/http/ngx_http_script.h:92">ngx_http_script_copy_code_t</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + ((code-&gt;len + <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>) &amp; ~(<span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) - <span class="Constant">1</span>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L142" title="src/core/ngx_log.h:142">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script copy: </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant">&quot;</span>, e-&gt;pos - p, p);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L759">&#x200c;</a><span class="linkable">ngx_http_script_add_var_code</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc, <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *name)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; index, *p;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; index = <a href="ngx_http_variables.c.html#L441" title="src/http/ngx_http_variables.c:441">ngx_http_get_variable_index</a>(sc-&gt;cf, name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (index == <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;flushes) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="../core/ngx_array.c.html#L48" title="src/core/ngx_array.c:48">ngx_array_push</a>(*sc-&gt;flushes);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *p = index;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;lengths,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>), <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = (<a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a>) <a href="#L803" title="src/http/ngx_http_script.c:803">ngx_http_script_copy_var_len_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;index = (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;values,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;sc-&gt;<a href="../core/nginx.c.html#L187" title="src/core/nginx.c:187">main</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = <a href="#L828" title="src/http/ngx_http_script.c:828">ngx_http_script_copy_var_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;index = (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) index;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L803">&#x200c;</a></span><span class="linkable">ngx_http_script_copy_var_len_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_variables.h.html#L17" title="src/http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp;&nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;flushed) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = <a href="ngx_http_variables.c.html#L501" title="src/http/ngx_http_variables.c:501">ngx_http_get_indexed_variable</a>(e-&gt;request, code-&gt;index);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = <a href="ngx_http_variables.c.html#L538" title="src/http/ngx_http_variables.c:538">ngx_http_get_flushed_variable</a>(e-&gt;request, code-&gt;index);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &amp;&amp; !value-&gt;not_found) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value-&gt;len;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L828">&#x200c;</a></span><span class="linkable">ngx_http_script_copy_var_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_variables.h.html#L17" title="src/http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp;&nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!e-&gt;skip) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;flushed) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value = <a href="ngx_http_variables.c.html#L501" title="src/http/ngx_http_variables.c:501">ngx_http_get_indexed_variable</a>(e-&gt;request, code-&gt;index);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value = <a href="ngx_http_variables.c.html#L538" title="src/http/ngx_http_variables.c:538">ngx_http_get_flushed_variable</a>(e-&gt;request, code-&gt;index);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (value &amp;&amp; !value-&gt;not_found) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = e-&gt;pos;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;pos = <a href="../core/ngx_string.h.html#L116" title="src/core/ngx_string.h:116">ngx_copy</a>(p, value-&gt;data, value-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L142" title="src/core/ngx_log.h:142">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script var: </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant">&quot;</span>, e-&gt;pos - p, p);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L860">&#x200c;</a><span class="linkable">ngx_http_script_add_args_code</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>&nbsp;&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;lengths, <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>), <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *code = (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) <a href="#L883" title="src/http/ngx_http_script.c:883">ngx_http_script_mark_args_code</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;values, <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>), &amp;sc-&gt;<a href="../core/nginx.c.html#L187" title="src/core/nginx.c:187">main</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *code = (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) <a href="#L893" title="src/http/ngx_http_script.c:893">ngx_http_script_start_args_code</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L883">&#x200c;</a></span><span class="linkable">ngx_http_script_mark_args_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; e-&gt;is_args = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L893">&#x200c;</a></span><span class="linkable">ngx_http_script_start_args_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script args&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;is_args = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; e-&gt;args = e-&gt;pos;<br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_PCRE)<br/></li>
<li></span><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L907">&#x200c;</a></span><span class="linkable">ngx_http_script_regex_start_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>&nbsp; &nbsp; &nbsp;&nbsp; le;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a>&nbsp; &nbsp; lcode;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L136" title="src/http/ngx_http_script.h:136">ngx_http_script_regex_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L136" title="src/http/ngx_http_script.h:136">ngx_http_script_regex_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = e-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L139" title="src/core/ngx_log.h:139">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script regex: </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;code-&gt;name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;line = r-&gt;uri;<br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;line.len = e-&gt;sp-&gt;len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;line.data = e-&gt;sp-&gt;data;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = <a href="ngx_http_variables.c.html#L2409" title="src/http/ngx_http_variables.c:2409">ngx_http_regex_exec</a>(r, code-&gt;regex, &amp;e-&gt;line);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L41" title="src/core/ngx_core.h:41">NGX_DECLINED</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;log || (r-&gt;connection-&gt;log-&gt;log_level &amp; <a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L22" title="src/core/ngx_log.h:22">NGX_LOG_NOTICE</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant"> does not match </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;code-&gt;name, &amp;e-&gt;line);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;ncaptures = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;test) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;negative_test) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;len = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;data = (u_char *) <span class="Constant">&quot;1&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;data = (u_char *) <span class="Constant">&quot;&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L136" title="src/http/ngx_http_script.h:136">ngx_http_script_regex_code_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip += code-&gt;next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_request.h.html#L130" title="src/http/ngx_http_request.h:130">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;log || (r-&gt;connection-&gt;log-&gt;log_level &amp; <a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L22" title="src/core/ngx_log.h:22">NGX_LOG_NOTICE</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant"> matches </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;code-&gt;name, &amp;e-&gt;line);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;test) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;negative_test) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;data = (u_char *) <span class="Constant">&quot;&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;len = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp-&gt;data = (u_char *) <span class="Constant">&quot;1&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L136" title="src/http/ngx_http_script.h:136">ngx_http_script_regex_code_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;status) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = code-&gt;status;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!code-&gt;redirect) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;internal = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;valid_unparsed_uri = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;break_cycle) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;valid_location = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;uri_changed = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;uri_changed = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;lengths == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len = code-&gt;size;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;ncaptures &amp;&amp; (r-&gt;quoted_uri || r-&gt;plus_in_uri)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len += <span class="Constant">2</span> * <a href="../core/ngx_string.c.html#L1425" title="src/core/ngx_string.c:1425">ngx_escape_uri</a>(<span class="Constant">NULL</span>, r-&gt;uri.data, r-&gt;uri.len,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../core/ngx_string.h.html#L196" title="src/core/ngx_string.h:196">NGX_ESCAPE_ARGS</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (n = <span class="Constant">2</span>; n &lt; r-&gt;ncaptures; n += <span class="Constant">2</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len += r-&gt;captures[n + <span class="Constant">1</span>] - r-&gt;captures[n];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;le, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; le.ip = code-&gt;lengths-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; le.line = e-&gt;line;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; le.request = r;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; le.quote = code-&gt;redirect;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> *) le.ip) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lcode = *(<a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a> *) le.ip;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += lcode(&amp;le);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len = len;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;add_args &amp;&amp; r-&gt;args.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len += r-&gt;args.len + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;buf.data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(r-&gt;pool, e-&gt;buf.len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;buf.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_request.h.html#L130" title="src/http/ngx_http_request.h:130">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;quote = code-&gt;redirect;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;pos = e-&gt;buf.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L136" title="src/http/ngx_http_script.h:136">ngx_http_script_regex_code_t</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1064">&#x200c;</a></span><span class="linkable">ngx_http_script_regex_end_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst, *src;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L149" title="src/http/ngx_http_script.h:149">ngx_http_script_regex_end_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L149" title="src/http/ngx_http_script.h:149">ngx_http_script_regex_end_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = e-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;quote = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script regex end&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;redirect) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst = e-&gt;buf.data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; src = e-&gt;buf.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1594" title="src/core/ngx_string.c:1594">ngx_unescape_uri</a>(&amp;dst, &amp;src, e-&gt;pos - e-&gt;buf.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../core/ngx_string.h.html#L204" title="src/core/ngx_string.h:204">NGX_UNESCAPE_REDIRECT</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (src &lt; e-&gt;pos) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="../core/ngx_string.h.html#L140" title="src/core/ngx_string.h:140">ngx_movemem</a>(dst, src, e-&gt;pos - src);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;pos = dst;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;add_args &amp;&amp; r-&gt;args.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *e-&gt;pos++ = (u_char) (code-&gt;args ? <span class="Constant">'&amp;'</span> : <span class="Constant">'?'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;pos = <a href="../core/ngx_string.h.html#L116" title="src/core/ngx_string.h:116">ngx_copy</a>(e-&gt;pos, r-&gt;args.data, r-&gt;args.len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len = e-&gt;pos - e-&gt;buf.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;log || (r-&gt;connection-&gt;log-&gt;log_level &amp; <a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L22" title="src/core/ngx_log.h:22">NGX_LOG_NOTICE</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rewritten redirect: </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;e-&gt;buf);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L578" title="src/http/ngx_http_core_module.h:578">ngx_http_clear_location</a>(r);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.location = <a href="../core/ngx_list.c.html#L31" title="src/core/ngx_list.c:31">ngx_list_push</a>(&amp;r-&gt;headers_out.headers);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_out.location == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_request.h.html#L130" title="src/http/ngx_http_request.h:130">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.location-&gt;hash = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L42" title="src/core/ngx_string.h:42">ngx_str_set</a>(&amp;r-&gt;headers_out.location-&gt;key, <span class="Constant">&quot;Location&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;headers_out.location-&gt;value = e-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L149" title="src/http/ngx_http_script.h:149">ngx_http_script_regex_end_code_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;args) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len = e-&gt;args - e-&gt;buf.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;add_args &amp;&amp; r-&gt;args.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *e-&gt;pos++ = <span class="Constant">'&amp;'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;pos = <a href="../core/ngx_string.h.html#L116" title="src/core/ngx_string.h:116">ngx_copy</a>(e-&gt;pos, r-&gt;args.data, r-&gt;args.len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;args.len = e-&gt;pos - e-&gt;args;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;args.data = e-&gt;args;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;args = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;buf.len = e-&gt;pos - e-&gt;buf.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!code-&gt;add_args) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r-&gt;args.len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;log || (r-&gt;connection-&gt;log-&gt;log_level &amp; <a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L22" title="src/core/ngx_log.h:22">NGX_LOG_NOTICE</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rewritten data: </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">, args: </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;e-&gt;buf, &amp;r-&gt;args);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; r-&gt;uri = e-&gt;buf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;uri.len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L20" title="src/core/ngx_log.h:20">NGX_LOG_ERR</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;the rewritten URI has a zero length&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_request.h.html#L130" title="src/http/ngx_http_request.h:130">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_core_module.c.html#L1768" title="src/http/ngx_http_core_module.c:1768">ngx_http_set_exten</a>(r);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L149" title="src/http/ngx_http_script.h:149">ngx_http_script_regex_end_code_t</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1168">&#x200c;</a><span class="linkable">ngx_http_script_add_capture_code</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc, <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;lengths,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = (<a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1203" title="src/http/ngx_http_script.c:1203">ngx_http_script_copy_capture_len_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;n = <span class="Constant">2</span> * n;<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;values,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;sc-&gt;<a href="../core/nginx.c.html#L187" title="src/core/nginx.c:187">main</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = <a href="#L1241" title="src/http/ngx_http_script.c:1241">ngx_http_script_copy_capture_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;n = <span class="Constant">2</span> * n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sc-&gt;ncaptures &lt; n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sc-&gt;ncaptures = n;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L1203">&#x200c;</a></span><span class="linkable">ngx_http_script_copy_capture_len_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cap;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = e-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = code-&gt;n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n &lt; r-&gt;ncaptures) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cap = r-&gt;captures;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((e-&gt;is_args || e-&gt;quote)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (e-&gt;request-&gt;quoted_uri || e-&gt;request-&gt;plus_in_uri))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = r-&gt;captures_data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> cap[n + <span class="Constant">1</span>] - cap[n]<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + <span class="Constant">2</span> * <a href="../core/ngx_string.c.html#L1425" title="src/core/ngx_string.c:1425">ngx_escape_uri</a>(<span class="Constant">NULL</span>, &amp;p[cap[n]], cap[n + <span class="Constant">1</span>] - cap[n],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_string.h.html#L196" title="src/core/ngx_string.h:196">NGX_ESCAPE_ARGS</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> cap[n + <span class="Constant">1</span>] - cap[n];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1241">&#x200c;</a></span><span class="linkable">ngx_http_script_copy_capture_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *cap;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p, *pos;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = e-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L111" title="src/http/ngx_http_script.h:111">ngx_http_script_copy_capture_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = code-&gt;n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pos = e-&gt;pos;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n &lt; r-&gt;ncaptures) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cap = r-&gt;captures;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = r-&gt;captures_data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((e-&gt;is_args || e-&gt;quote)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (e-&gt;request-&gt;quoted_uri || e-&gt;request-&gt;plus_in_uri))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;pos = (u_char *) <a href="../core/ngx_string.c.html#L1425" title="src/core/ngx_string.c:1425">ngx_escape_uri</a>(pos, &amp;p[cap[n]],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cap[n + <span class="Constant">1</span>] - cap[n],<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../core/ngx_string.h.html#L196" title="src/core/ngx_string.h:196">NGX_ESCAPE_ARGS</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;pos = <a href="../core/ngx_string.h.html#L116" title="src/core/ngx_string.h:116">ngx_copy</a>(pos, &amp;p[cap[n]], cap[n + <span class="Constant">1</span>] - cap[n]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L142" title="src/core/ngx_log.h:142">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script capture: </span><span class="Special">\&quot;%*s\&quot;</span><span class="Constant">&quot;</span>, e-&gt;pos - pos, pos);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1283">&#x200c;</a><span class="linkable">ngx_http_script_add_full_name_code</span>(<a href="ngx_http_script.h.html#L63" title="src/http/ngx_http_script.h:63">ngx_http_script_compile_t</a> *sc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;lengths,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = (<a href="ngx_http_script.h.html#L85" title="src/http/ngx_http_script.h:85">ngx_http_script_code_pt</a>) <a href="#L1312" title="src/http/ngx_http_script.c:1312">ngx_http_script_full_name_len_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;conf_prefix = sc-&gt;conf_prefix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = <a href="#L656" title="src/http/ngx_http_script.c:656">ngx_http_script_add_code</a>(*sc-&gt;values,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;sc-&gt;<a href="../core/nginx.c.html#L187" title="src/core/nginx.c:187">main</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;code = <a href="#L1326" title="src/http/ngx_http_script.c:1326">ngx_http_script_full_name_code</a>;<br/></li>
<li>&nbsp; &nbsp; code-&gt;conf_prefix = sc-&gt;conf_prefix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">size_t<br/></li>
<li><a id="L1312">&#x200c;</a></span><span class="linkable">ngx_http_script_full_name_len_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> code-&gt;conf_prefix ? <a href="../core/ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_prefix.len:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../core/ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;prefix.len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1326">&#x200c;</a></span><span class="linkable">ngx_http_script_full_name_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; value, *prefix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value.data = e-&gt;buf.data;<br/></li>
<li>&nbsp; &nbsp; value.len = e-&gt;pos - e-&gt;buf.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; prefix = code-&gt;conf_prefix ? (<a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *) &amp;<a href="../core/ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_prefix:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *) &amp;<a href="../core/ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;prefix;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_file.c.html#L21" title="src/core/ngx_file.c:21">ngx_get_full_name</a>(e-&gt;request-&gt;pool, prefix, &amp;value) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_request.h.html#L130" title="src/http/ngx_http_request.h:130">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;buf = value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L139" title="src/core/ngx_log.h:139">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script fullname: </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;value);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L157" title="src/http/ngx_http_script.h:157">ngx_http_script_full_name_code_t</a>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1356">&#x200c;</a></span><span class="linkable">ngx_http_script_return_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L164" title="src/http/ngx_http_script.h:164">ngx_http_script_return_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L164" title="src/http/ngx_http_script.h:164">ngx_http_script_return_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;status &lt; <a href="ngx_http_request.h.html#L85" title="src/http/ngx_http_request.h:85">NGX_HTTP_BAD_REQUEST</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; || code-&gt;text.value.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; || code-&gt;text.lengths)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_core_module.c.html#L1869" title="src/http/ngx_http_core_module.c:1869">ngx_http_send_response</a>(e-&gt;request, code-&gt;status, <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;code-&gt;text);<br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = code-&gt;status;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1377">&#x200c;</a></span><span class="linkable">ngx_http_script_break_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; e-&gt;request-&gt;uri_changed = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1386">&#x200c;</a></span><span class="linkable">ngx_http_script_if_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L189" title="src/http/ngx_http_script.h:189">ngx_http_script_if_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L189" title="src/http/ngx_http_script.h:189">ngx_http_script_if_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script if&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;sp-&gt;len &amp;&amp; (e-&gt;sp-&gt;len != <span class="Constant">1</span> || e-&gt;sp-&gt;data[<span class="Constant">0</span>] != <span class="Constant">'0'</span>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (code-&gt;loc_conf) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e-&gt;request-&gt;loc_conf = code-&gt;loc_conf;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_http_core_module.c.html#L1423" title="src/http/ngx_http_core_module.c:1423">ngx_http_update_location_config</a>(e-&gt;request);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L189" title="src/http/ngx_http_script.h:189">ngx_http_script_if_code_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script if: false&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += code-&gt;next;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1415">&#x200c;</a></span><span class="linkable">ngx_http_script_equal_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_variables.h.html#L17" title="src/http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp; *val, *res;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script equal&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp--;<br/></li>
<li>&nbsp; &nbsp; val = e-&gt;sp;<br/></li>
<li>&nbsp; &nbsp; res = e-&gt;sp - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (val-&gt;len == res-&gt;len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <a href="../core/ngx_string.h.html#L53" title="src/core/ngx_string.h:53">ngx_strncmp</a>(val-&gt;data, res-&gt;data, res-&gt;len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *res = <a href="ngx_http_variables.c.html#L365" title="src/http/ngx_http_variables.c:365">ngx_http_variable_true_value</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script equal: no&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *res = <a href="ngx_http_variables.c.html#L363" title="src/http/ngx_http_variables.c:363">ngx_http_variable_null_value</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1443">&#x200c;</a></span><span class="linkable">ngx_http_script_not_equal_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_variables.h.html#L17" title="src/http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp; *val, *res;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script not equal&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp--;<br/></li>
<li>&nbsp; &nbsp; val = e-&gt;sp;<br/></li>
<li>&nbsp; &nbsp; res = e-&gt;sp - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (val-&gt;len == res-&gt;len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <a href="../core/ngx_string.h.html#L53" title="src/core/ngx_string.h:53">ngx_strncmp</a>(val-&gt;data, res-&gt;data, res-&gt;len) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script not equal: no&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *res = <a href="ngx_http_variables.c.html#L363" title="src/http/ngx_http_variables.c:363">ngx_http_variable_null_value</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *res = <a href="ngx_http_variables.c.html#L365" title="src/http/ngx_http_variables.c:365">ngx_http_variable_true_value</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1471">&#x200c;</a></span><span class="linkable">ngx_http_script_file_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; path;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_open_file_cache.h.html#L51" title="src/core/ngx_open_file_cache.h:51">ngx_open_file_info_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; of;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L57" title="src/http/ngx_http_core_module.h:57">ngx_http_core_loc_conf_t</a>&nbsp; &nbsp;&nbsp; *clcf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_variables.h.html#L17" title="src/http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp; &nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L182" title="src/http/ngx_http_script.h:182">ngx_http_script_file_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = e-&gt;sp - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L182" title="src/http/ngx_http_script.h:182">ngx_http_script_file_code_t</a> *) e-&gt;ip;<br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L182" title="src/http/ngx_http_script.h:182">ngx_http_script_file_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; path.len = value-&gt;len - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; path.data = value-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = e-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L142" title="src/core/ngx_log.h:142">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script file op </span><span class="Special">%p</span><span class="Constant"> </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, (<span class="Type">void</span> *) code-&gt;op, &amp;path);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; clcf = <a href="ngx_http_config.h.html#L58" title="src/http/ngx_http_config.h:58">ngx_http_get_module_loc_conf</a>(r, <a href="ngx_http_core_module.c.html#L781" title="src/http/ngx_http_core_module.c:781">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;of, <span class="Statement">sizeof</span>(<a href="../core/ngx_open_file_cache.h.html#L51" title="src/core/ngx_open_file_cache.h:51">ngx_open_file_info_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; of.read_ahead = clcf-&gt;read_ahead;<br/></li>
<li>&nbsp; &nbsp; of.directio = clcf-&gt;directio;<br/></li>
<li>&nbsp; &nbsp; of.valid = clcf-&gt;open_file_cache_valid;<br/></li>
<li>&nbsp; &nbsp; of.min_uses = clcf-&gt;open_file_cache_min_uses;<br/></li>
<li>&nbsp; &nbsp; of.test_only = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; of.errors = clcf-&gt;open_file_cache_errors;<br/></li>
<li>&nbsp; &nbsp; of.events = clcf-&gt;open_file_cache_events;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_http_core_module.c.html#L2741" title="src/http/ngx_http_core_module.c:2741">ngx_http_set_disable_symlinks</a>(r, clcf, &amp;path, &amp;of) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_request.h.html#L130" title="src/http/ngx_http_request.h:130">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_open_file_cache.c.html#L144" title="src/core/ngx_open_file_cache.c:144">ngx_open_cached_file</a>(clcf-&gt;open_file_cache, &amp;path, &amp;of, r-&gt;pool)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.err != <a href="../os/win32/ngx_errno.h.html#L24" title="src/os/win32/ngx_errno.h:24">NGX_ENOENT</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; of.err != <a href="../os/win32/ngx_errno.h.html#L37" title="src/os/win32/ngx_errno.h:37">NGX_ENOTDIR</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; of.err != <a href="../os/win32/ngx_errno.h.html#L51" title="src/os/win32/ngx_errno.h:51">NGX_ENAMETOOLONG</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L19" title="src/core/ngx_log.h:19">NGX_LOG_CRIT</a>, r-&gt;connection-&gt;log, of.err,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">%s</span><span class="Constant"> </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> failed&quot;</span>, of.failed, value-&gt;data);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (code-&gt;op) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_plain:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_dir:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_exists:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_exec:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_plain:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_dir:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_exists:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_exec:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (code-&gt;op) {<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_plain:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_file) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_plain:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_file) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_dir:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_dir) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_dir:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_dir) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_exists:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_file || of.is_dir || of.is_link) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_exists:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_file || of.is_dir || of.is_link) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_exec:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_exec) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> ngx_http_script_file_not_exec:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (of.is_exec) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> false_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> true_value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="Statement">false_value</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script file op false&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *value = <a href="ngx_http_variables.c.html#L363" title="src/http/ngx_http_variables.c:363">ngx_http_variable_null_value</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li><br/></li>
<li><span class="Statement">true_value</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; *value = <a href="ngx_http_variables.c.html#L365" title="src/http/ngx_http_variables.c:365">ngx_http_variable_true_value</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1606">&#x200c;</a></span><span class="linkable">ngx_http_script_complex_value_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; le;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lcode;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L195" title="src/http/ngx_http_script.h:195">ngx_http_script_complex_value_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L195" title="src/http/ngx_http_script.h:195">ngx_http_script_complex_value_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L195" title="src/http/ngx_http_script.h:195">ngx_http_script_complex_value_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script complex value&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;le, <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; le.ip = code-&gt;lengths-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; le.line = e-&gt;line;<br/></li>
<li>&nbsp; &nbsp; le.request = e-&gt;request;<br/></li>
<li>&nbsp; &nbsp; le.quote = e-&gt;quote;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (len = <span class="Constant">0</span>; *(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> *) le.ip; len += lcode(&amp;le)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lcode = *(<a href="ngx_http_script.h.html#L86" title="src/http/ngx_http_script.h:86">ngx_http_script_len_code_pt</a> *) le.ip;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;buf.len = len;<br/></li>
<li>&nbsp; &nbsp; e-&gt;buf.data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(e-&gt;request-&gt;pool, len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (e-&gt;buf.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;ip = <a href="#L30" title="src/http/ngx_http_script.c:30">ngx_http_script_exit</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;status = <a href="ngx_http_request.h.html#L130" title="src/http/ngx_http_request.h:130">NGX_HTTP_INTERNAL_SERVER_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;pos = e-&gt;buf.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp-&gt;len = e-&gt;buf.len;<br/></li>
<li>&nbsp; &nbsp; e-&gt;sp-&gt;data = e-&gt;buf.data;<br/></li>
<li>&nbsp; &nbsp; e-&gt;sp++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1648">&#x200c;</a></span><span class="linkable">ngx_http_script_value_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L203" title="src/http/ngx_http_script.h:203">ngx_http_script_value_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L203" title="src/http/ngx_http_script.h:203">ngx_http_script_value_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L203" title="src/http/ngx_http_script.h:203">ngx_http_script_value_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp-&gt;len = code-&gt;text_len;<br/></li>
<li>&nbsp; &nbsp; e-&gt;sp-&gt;data = (u_char *) code-&gt;text_data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L139" title="src/core/ngx_log.h:139">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script value: </span><span class="Special">\&quot;</span><span class="Constant">%v</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, e-&gt;sp);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1667">&#x200c;</a></span><span class="linkable">ngx_http_script_set_var_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http.h.html#L16" title="src/http/ngx_http.h:16">ngx_http_request_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *r;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r = e-&gt;request;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; r-&gt;variables[code-&gt;index].len = e-&gt;sp-&gt;len;<br/></li>
<li>&nbsp; &nbsp; r-&gt;variables[code-&gt;index].valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; r-&gt;variables[code-&gt;index].no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; r-&gt;variables[code-&gt;index].not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; r-&gt;variables[code-&gt;index].data = e-&gt;sp-&gt;data;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_DEBUG)<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_variables.h.html#L21" title="src/http/ngx_http_variables.h:21">ngx_http_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_core_module.h.html#L178" title="src/http/ngx_http_core_module.h:178">ngx_http_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_http_config.h.html#L55" title="src/http/ngx_http_config.h:55">ngx_http_get_module_main_conf</a>(r, <a href="ngx_http_core_module.c.html#L781" title="src/http/ngx_http_core_module.c:781">ngx_http_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = cmcf-&gt;variables.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L139" title="src/core/ngx_log.h:139">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script set $%V&quot;</span>, &amp;v[code-&gt;index].name);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1703">&#x200c;</a></span><span class="linkable">ngx_http_script_var_set_handler_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L105" title="src/http/ngx_http_script.h:105">ngx_http_script_var_handler_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script set var handler&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L105" title="src/http/ngx_http_script.h:105">ngx_http_script_var_handler_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L105" title="src/http/ngx_http_script.h:105">ngx_http_script_var_handler_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;sp--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code-&gt;handler(e-&gt;request, e-&gt;sp, code-&gt;data);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1721">&#x200c;</a></span><span class="linkable">ngx_http_script_var_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_variables.h.html#L17" title="src/http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp;&nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>&nbsp; *code;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_log.h.html#L136" title="src/core/ngx_log.h:136">ngx_log_debug0</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script var&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; code = (<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a> *) e-&gt;ip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<a href="ngx_http_script.h.html#L98" title="src/http/ngx_http_script.h:98">ngx_http_script_var_code_t</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = <a href="ngx_http_variables.c.html#L538" title="src/http/ngx_http_variables.c:538">ngx_http_get_flushed_variable</a>(e-&gt;request, code-&gt;index);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &amp;&amp; !value-&gt;not_found) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L139" title="src/core/ngx_log.h:139">ngx_log_debug1</a>(<a href="../core/ngx_log.h.html#L30" title="src/core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, e-&gt;request-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;http script var: </span><span class="Special">\&quot;</span><span class="Constant">%v</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, value);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *e-&gt;sp = *value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; e-&gt;sp++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *e-&gt;sp = <a href="ngx_http_variables.c.html#L363" title="src/http/ngx_http_variables.c:363">ngx_http_variable_null_value</a>;<br/></li>
<li>&nbsp; &nbsp; e-&gt;sp++;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1751">&#x200c;</a></span><span class="linkable">ngx_http_script_nop_code</span>(<a href="ngx_http_script.h.html#L36" title="src/http/ngx_http_script.h:36">ngx_http_script_engine_t</a> *e)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; e-&gt;ip += <span class="Statement">sizeof</span>(<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>);<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
