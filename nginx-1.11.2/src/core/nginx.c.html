<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>src/core/nginx.c - Nginx 1.11.2</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>src/core/nginx.c - Nginx 1.11.2</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L178">ngx_conf_file</a></li>
<li><a href="#L179">ngx_conf_params</a></li>
<li><a href="#L40">ngx_core_commands</a></li>
<li><a href="#L158">ngx_core_module</a></li>
<li><a href="#L151">ngx_core_module_ctx</a></li>
<li><a href="#L33">ngx_debug_points</a></li>
<li><a href="#L183">ngx_os_environ</a></li>
<li><a href="#L177">ngx_prefix</a></li>
<li><a href="#L176">ngx_show_configure</a></li>
<li><a href="#L174">ngx_show_help</a></li>
<li><a href="#L175">ngx_show_version</a></li>
<li><a href="#L180">ngx_signal</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L187">main</a></li>
<li><a href="#L437">ngx_add_inherited_sockets</a></li>
<li><a href="#L962">ngx_core_module_create_conf</a></li>
<li><a href="#L1006">ngx_core_module_init_conf</a></li>
<li><a href="#L595">ngx_exec_new_binary</a></li>
<li><a href="#L1365">ngx_get_cpu_affinity</a></li>
<li><a href="#L696">ngx_get_options</a></li>
<li><a href="#L1448">ngx_load_module</a></li>
<li><a href="#L866">ngx_process_options</a></li>
<li><a href="#L824">ngx_save_argv</a></li>
<li><a href="#L1267">ngx_set_cpu_affinity</a></li>
<li><a href="#L1197">ngx_set_env</a></li>
<li><a href="#L496">ngx_set_environment</a></li>
<li><a href="#L1227">ngx_set_priority</a></li>
<li><a href="#L1134">ngx_set_user</a></li>
<li><a href="#L1419">ngx_set_worker_processes</a></li>
<li><a href="#L375">ngx_show_version_info</a></li>
<li><a href="#L1532">ngx_unload_module</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;<a href="../http/modules/perl/ngx_http_perl_module.h.html#L21" title="src/http/modules/perl/ngx_http_perl_module.h:21">nginx</a>.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L375" title="src/core/nginx.c:375">ngx_show_version_info</a>(<span class="Type">void</span>);<br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L437" title="src/core/nginx.c:437">ngx_add_inherited_sockets</a>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle);<br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L696" title="src/core/nginx.c:696">ngx_get_options</a>(<span class="Type">int</span> argc, <span class="Type">char</span> *<span class="Type">const</span> *argv);<br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L866" title="src/core/nginx.c:866">ngx_process_options</a>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle);<br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L824" title="src/core/nginx.c:824">ngx_save_argv</a>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle, <span class="Type">int</span> argc, <span class="Type">char</span> *<span class="Type">const</span> *argv);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<a href="#L962" title="src/core/nginx.c:962">ngx_core_module_create_conf</a>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1006" title="src/core/nginx.c:1006">ngx_core_module_init_conf</a>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle, <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1134" title="src/core/nginx.c:1134">ngx_set_user</a>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1197" title="src/core/nginx.c:1197">ngx_set_env</a>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1227" title="src/core/nginx.c:1227">ngx_set_priority</a>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1267" title="src/core/nginx.c:1267">ngx_set_cpu_affinity</a>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1419" title="src/core/nginx.c:1419">ngx_set_worker_processes</a>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L1448" title="src/core/nginx.c:1448">ngx_load_module</a>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf);<br/></li>
<li><span class="PreProc">#if (<a href="../os/win32/ngx_dlopen.h.html#L16" title="src/os/win32/ngx_dlopen.h:16">NGX_HAVE_DLOPEN</a>)<br/></li>
<li></span><span class="Type">static</span> <span class="Type">void</span> <a href="#L1532" title="src/core/nginx.c:1532">ngx_unload_module</a>(<span class="Type">void</span> *data);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L33">&#x200c;</a><span class="Type">static</span> <a href="ngx_conf_file.h.html#L160" title="src/core/ngx_conf_file.h:160">ngx_conf_enum_t</a>&nbsp; <span class="linkable">ngx_debug_points</span>[] = {<br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;stop&quot;</span>), <a href="ngx_cycle.h.html#L21" title="src/core/ngx_cycle.h:21">NGX_DEBUG_POINTS_STOP</a> },<br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;abort&quot;</span>), <a href="ngx_cycle.h.html#L22" title="src/core/ngx_cycle.h:22">NGX_DEBUG_POINTS_ABORT</a> },<br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L41" title="src/core/ngx_string.h:41">ngx_null_string</a>, <span class="Constant">0</span> }<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L40">&#x200c;</a><span class="Type">static</span> <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a>&nbsp; <span class="linkable">ngx_core_commands</span>[] = {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;daemon&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L44" title="src/core/ngx_conf_file.h:44">NGX_CONF_FLAG</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L984" title="src/core/ngx_conf_file.c:984">ngx_conf_set_flag_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, daemon),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;<a href="../os/unix/ngx_process_cycle.c.html#L55" title="src/os/unix/ngx_process_cycle.c:55">master_process</a>&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L44" title="src/core/ngx_conf_file.h:44">NGX_CONF_FLAG</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L984" title="src/core/ngx_conf_file.c:984">ngx_conf_set_flag_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, master),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;timer_resolution&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L1218" title="src/core/ngx_conf_file.c:1218">ngx_conf_set_msec_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, timer_resolution),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;pid&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L1024" title="src/core/ngx_conf_file.c:1024">ngx_conf_set_str_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, pid),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;lock_file&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L1024" title="src/core/ngx_conf_file.c:1024">ngx_conf_set_str_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, lock_file),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;worker_processes&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L1419" title="src/core/nginx.c:1419">ngx_set_worker_processes</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;debug_points&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L1310" title="src/core/ngx_conf_file.c:1310">ngx_conf_set_enum_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, debug_points),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &amp;<a href="#L33" title="src/core/nginx.c:33">ngx_debug_points</a> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;user&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L33" title="src/core/ngx_conf_file.h:33">NGX_CONF_TAKE12</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L1134" title="src/core/nginx.c:1134">ngx_set_user</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;worker_priority&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L1227" title="src/core/nginx.c:1227">ngx_set_priority</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;worker_cpu_affinity&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L46" title="src/core/ngx_conf_file.h:46">NGX_CONF_1MORE</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L1267" title="src/core/nginx.c:1267">ngx_set_cpu_affinity</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;worker_rlimit_nofile&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L1125" title="src/core/ngx_conf_file.c:1125">ngx_conf_set_num_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, rlimit_nofile),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;worker_rlimit_core&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L1187" title="src/core/ngx_conf_file.c:1187">ngx_conf_set_off_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, rlimit_core),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;working_directory&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L1024" title="src/core/ngx_conf_file.c:1024">ngx_conf_set_str_slot</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; offsetof(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>, working_directory),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;env&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L1197" title="src/core/nginx.c:1197">ngx_set_env</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;load_module&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L51" title="src/core/ngx_conf_file.h:51">NGX_MAIN_CONF</a>|<a href="ngx_conf_file.h.html#L49" title="src/core/ngx_conf_file.h:49">NGX_DIRECT_CONF</a>|<a href="ngx_conf_file.h.html#L23" title="src/core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L1448" title="src/core/nginx.c:1448">ngx_load_module</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.h.html#L86" title="src/core/ngx_conf_file.h:86">ngx_null_command</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L151">&#x200c;</a><span class="Type">static</span> <a href="ngx_module.h.html#L279" title="src/core/ngx_module.h:279">ngx_core_module_t</a>&nbsp; <span class="linkable">ngx_core_module_ctx</span> = {<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;core&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; <a href="#L962" title="src/core/nginx.c:962">ngx_core_module_create_conf</a>,<br/></li>
<li>&nbsp; &nbsp; <a href="#L1006" title="src/core/nginx.c:1006">ngx_core_module_init_conf</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L158">&#x200c;</a><a href="ngx_core.h.html#L15" title="src/core/ngx_core.h:15">ngx_module_t</a>&nbsp; <span class="linkable">ngx_core_module</span> = {<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_module.h.html#L230" title="src/core/ngx_module.h:230">NGX_MODULE_V1</a>,<br/></li>
<li>&nbsp; &nbsp; &amp;<a href="#L151" title="src/core/nginx.c:151">ngx_core_module_ctx</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* module context */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L40" title="src/core/nginx.c:40">ngx_core_commands</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* module directives */<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_conf_file.h.html#L70" title="src/core/ngx_conf_file.h:70">NGX_CORE_MODULE</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* module type */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init master */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init module */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit master */<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_module.h.html#L234" title="src/core/ngx_module.h:234">NGX_MODULE_V1_PADDING</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L174">&#x200c;</a><span class="Type">static</span> <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; <span class="linkable">ngx_show_help</span>;<br/></li>
<li><a id="L175">&#x200c;</a><span class="Type">static</span> <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; <span class="linkable">ngx_show_version</span>;<br/></li>
<li><a id="L176">&#x200c;</a><span class="Type">static</span> <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; <span class="linkable">ngx_show_configure</span>;<br/></li>
<li><a id="L177">&#x200c;</a><span class="Type">static</span> u_char&nbsp; &nbsp; &nbsp; *<span class="linkable">ngx_prefix</span>;<br/></li>
<li><a id="L178">&#x200c;</a><span class="Type">static</span> u_char&nbsp; &nbsp; &nbsp; *<span class="linkable">ngx_conf_file</span>;<br/></li>
<li><a id="L179">&#x200c;</a><span class="Type">static</span> u_char&nbsp; &nbsp; &nbsp; *<span class="linkable">ngx_conf_params</span>;<br/></li>
<li><a id="L180">&#x200c;</a><span class="Type">static</span> <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; *<span class="linkable">ngx_signal</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L183">&#x200c;</a><span class="Type">static</span> <span class="Type">char</span> **<span class="linkable">ngx_os_environ</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">int</span> <a href="../os/win32/ngx_win32_config.h.html#L128" title="src/os/win32/ngx_win32_config.h:128">ngx_cdecl</a><br/></li>
<li><a id="L187">&#x200c;</a><span class="linkable">main</span>(<span class="Type">int</span> argc, <span class="Type">char</span> *<span class="Type">const</span> *argv)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_buf.h.html#L18" title="src/core/ngx_buf.h:18">ngx_buf_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *b;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_core.h.html#L20" title="src/core/ngx_core.h:20">ngx_log_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *log;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a>&nbsp; &nbsp; &nbsp; *cycle, init_cycle;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.h.html#L109" title="src/core/ngx_conf_file.h:109">ngx_conf_dump_t</a>&nbsp; *cd;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_win32_config.h.html#L262" title="src/os/win32/ngx_win32_config.h:262">ngx_debug_init</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_errno.c.html#L57" title="src/os/win32/ngx_errno.c:57">ngx_strerror_init</a>() != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L696" title="src/core/nginx.c:696">ngx_get_options</a>(argc, argv) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L175" title="src/core/nginx.c:175">ngx_show_version</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L375" title="src/core/nginx.c:375">ngx_show_version_info</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="ngx_cycle.c.html#L26" title="src/core/ngx_cycle.c:26">ngx_test_config</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* </span><span class="Todo">TODO</span><span class="Comment"> */</span> <a href="../os/win32/ngx_win32_init.c.html#L16" title="src/os/win32/ngx_win32_init.c:16">ngx_max_sockets</a> = -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_times.c.html#L63" title="src/core/ngx_times.c:63">ngx_time_init</a>();<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_PCRE)<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_regex.c.html#L73" title="src/core/ngx_regex.c:73">ngx_regex_init</a>();<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process_cycle.c.html#L33" title="src/os/win32/ngx_process_cycle.c:33">ngx_pid</a> = <a href="../os/win32/ngx_process.h.html#L16" title="src/os/win32/ngx_process.h:16">ngx_getpid</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; log = <a href="ngx_log.c.html#L318" title="src/core/ngx_log.c:318">ngx_log_init</a>(<a href="#L177" title="src/core/nginx.c:177">ngx_prefix</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (log == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* STUB */<br/></li>
<li></span><span class="PreProc">#if (NGX_OPENSSL)<br/></li>
<li></span>&nbsp; &nbsp; <a href="../event/ngx_event_openssl.c.html#L113" title="src/event/ngx_event_openssl.c:113">ngx_ssl_init</a>(log);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * init_cycle-&gt;log is required for signal handlers and<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="#L866" title="src/core/nginx.c:866">ngx_process_options</a>()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;init_cycle, <span class="Statement">sizeof</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a>));<br/></li>
<li>&nbsp; &nbsp; init_cycle.log = log;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a> = &amp;init_cycle;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; init_cycle.pool = <a href="ngx_palloc.c.html#L20" title="src/core/ngx_palloc.c:20">ngx_create_pool</a>(<span class="Constant">1024</span>, log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (init_cycle.pool == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L824" title="src/core/nginx.c:824">ngx_save_argv</a>(&amp;init_cycle, argc, argv) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L866" title="src/core/nginx.c:866">ngx_process_options</a>(&amp;init_cycle) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_win32_init.c.html#L60" title="src/os/win32/ngx_win32_init.c:60">ngx_os_init</a>(log) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="ngx_crc32.c.html#L106" title="src/core/ngx_crc32.c:106">ngx_crc32_table_init</a>() requires <a href="../os/win32/ngx_alloc.c.html#L14" title="src/os/win32/ngx_alloc.c:14">ngx_cacheline_size</a> set in <a href="../os/win32/ngx_win32_init.c.html#L60" title="src/os/win32/ngx_win32_init.c:60">ngx_os_init</a>()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_crc32.c.html#L106" title="src/core/ngx_crc32.c:106">ngx_crc32_table_init</a>() != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L437" title="src/core/nginx.c:437">ngx_add_inherited_sockets</a>(&amp;init_cycle) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_module.c.html#L26" title="src/core/ngx_module.c:26">ngx_preinit_modules</a>() != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cycle = <a href="ngx_cycle.c.html#L37" title="src/core/ngx_cycle.c:37">ngx_init_cycle</a>(&amp;init_cycle);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cycle == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_cycle.c.html#L26" title="src/core/ngx_cycle.c:26">ngx_test_config</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;configuration file </span><span class="Special">%s</span><span class="Constant"> test failed&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; init_cycle.conf_file.data);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_cycle.c.html#L26" title="src/core/ngx_cycle.c:26">ngx_test_config</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!<a href="ngx_cycle.c.html#L28" title="src/core/ngx_cycle.c:28">ngx_quiet_mode</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;configuration file </span><span class="Special">%s</span><span class="Constant"> test is successful&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; cycle-&gt;conf_file.data);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_cycle.c.html#L27" title="src/core/ngx_cycle.c:27">ngx_dump_config</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd = cycle-&gt;config_dump.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cycle-&gt;config_dump.nelts; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L260" title="src/core/ngx_log.h:260">ngx_write_stdout</a>(<span class="Constant">&quot;# configuration file &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span>) <a href="../os/win32/ngx_files.c.html#L178" title="src/os/win32/ngx_files.c:178">ngx_write_fd</a>(<a href="../os/win32/ngx_files.h.html#L267" title="src/os/win32/ngx_files.h:267">ngx_stdout</a>, cd[i].name.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cd[i].name.len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L260" title="src/core/ngx_log.h:260">ngx_write_stdout</a>(<span class="Constant">&quot;:&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; b = cd[i].buffer;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span>) <a href="../os/win32/ngx_files.c.html#L178" title="src/os/win32/ngx_files.c:178">ngx_write_fd</a>(<a href="../os/win32/ngx_files.h.html#L267" title="src/os/win32/ngx_files.h:267">ngx_stdout</a>, b-&gt;pos, b-&gt;last - b-&gt;pos);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L260" title="src/core/ngx_log.h:260">ngx_write_stdout</a>(<a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L180" title="src/core/nginx.c:180">ngx_signal</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_cycle.c.html#L1006" title="src/core/ngx_cycle.c:1006">ngx_signal_process</a>(cycle, <a href="#L180" title="src/core/nginx.c:180">ngx_signal</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_win32_init.c.html#L247" title="src/os/win32/ngx_win32_init.c:247">ngx_os_status</a>(cycle-&gt;log);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a> = cycle;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf = (<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a> *) <a href="ngx_conf_file.h.html#L176" title="src/core/ngx_conf_file.h:176">ngx_get_conf</a>(cycle-&gt;conf_ctx, <a href="#L158" title="src/core/nginx.c:158">ngx_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;master &amp;&amp; <a href="../os/win32/ngx_process_cycle.c.html#L31" title="src/os/win32/ngx_process_cycle.c:31">ngx_process</a> == <a href="../os/win32/ngx_process_cycle.h.html#L16" title="src/os/win32/ngx_process_cycle.h:16">NGX_PROCESS_SINGLE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_process_cycle.c.html#L31" title="src/os/win32/ngx_process_cycle.c:31">ngx_process</a> = <a href="../os/win32/ngx_process_cycle.h.html#L17" title="src/os/win32/ngx_process_cycle.h:17">NGX_PROCESS_MASTER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if !(NGX_WIN32)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/unix/ngx_process.c.html#L284" title="src/os/unix/ngx_process.c:284">ngx_init_signals</a>(cycle-&gt;log) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!<a href="../os/win32/ngx_process_cycle.c.html#L35" title="src/os/win32/ngx_process_cycle.c:35">ngx_inherited</a> &amp;&amp; ccf-&gt;daemon) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/unix/ngx_daemon.c.html#L13" title="src/os/unix/ngx_daemon.c:13">ngx_daemon</a>(cycle-&gt;log) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_process_cycle.c.html#L48" title="src/os/unix/ngx_process_cycle.c:48">ngx_daemonized</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_process_cycle.c.html#L35" title="src/os/win32/ngx_process_cycle.c:35">ngx_inherited</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_process_cycle.c.html#L48" title="src/os/unix/ngx_process_cycle.c:48">ngx_daemonized</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_cycle.c.html#L944" title="src/core/ngx_cycle.c:944">ngx_create_pidfile</a>(&amp;ccf-&gt;pid, cycle-&gt;log) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_log.c.html#L442" title="src/core/ngx_log.c:442">ngx_log_redirect_stderr</a>(cycle) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (log-&gt;file-&gt;fd != <a href="../os/win32/ngx_files.h.html#L268" title="src/os/win32/ngx_files.h:268">ngx_stderr</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_files.h.html#L102" title="src/os/win32/ngx_files.h:102">ngx_close_file</a>(log-&gt;file-&gt;fd) == <a href="../os/win32/ngx_files.h.html#L69" title="src/os/win32/ngx_files.h:69">NGX_FILE_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L18" title="src/core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_files.h.html#L103" title="src/os/win32/ngx_files.h:103">ngx_close_file_n</a> <span class="Constant">&quot; built-in log failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_log.c.html#L72" title="src/core/ngx_log.c:72">ngx_use_stderr</a> = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_process_cycle.c.html#L31" title="src/os/win32/ngx_process_cycle.c:31">ngx_process</a> == <a href="../os/win32/ngx_process_cycle.h.html#L16" title="src/os/win32/ngx_process_cycle.h:16">NGX_PROCESS_SINGLE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_process_cycle.c.html#L983" title="src/os/win32/ngx_process_cycle.c:983">ngx_single_process_cycle</a>(cycle);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_process_cycle.c.html#L63" title="src/os/win32/ngx_process_cycle.c:63">ngx_master_process_cycle</a>(cycle);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L375">&#x200c;</a></span><span class="linkable">ngx_show_version_info</span>(<span class="Type">void</span>)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;<a href="../http/modules/perl/ngx_http_perl_module.h.html#L21" title="src/http/modules/perl/ngx_http_perl_module.h:21">nginx</a> version: &quot;</span> <a href="nginx.h.html#L17" title="src/core/nginx.h:17">NGINX_VER_BUILD</a> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L174" title="src/core/nginx.c:174">ngx_show_help</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;Usage: <a href="../http/modules/perl/ngx_http_perl_module.h.html#L21" title="src/http/modules/perl/ngx_http_perl_module.h:21">nginx</a> [-?hvVtTq] [-s signal] [-c filename] &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;[-p prefix] [-g directives]&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;Options:&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -?,-h&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; : this help&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -v&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : show version and exit&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -V&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : show version and configure options then exit&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : test configuration and exit&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -T&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : test configuration, dump it and exit&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -q&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : suppress non-error messages &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;during configuration testing&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -s signal&nbsp; &nbsp;&nbsp; : send signal to a master process: &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;stop, quit, reopen, reload&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li><span class="PreProc">#ifdef NGX_PREFIX<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -p prefix&nbsp; &nbsp;&nbsp; : set prefix path (default: &quot;</span> NGX_PREFIX <span class="Constant">&quot;)&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -p prefix&nbsp; &nbsp;&nbsp; : set prefix path (default: NONE)&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -c filename&nbsp;&nbsp; : set configuration file (default: &quot;</span> NGX_CONF_PATH<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;)&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;&nbsp; -g directives : set global directives out of configuration &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;file&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; );<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L176" title="src/core/nginx.c:176">ngx_show_configure</a>) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifdef NGX_COMPILER<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;built by &quot;</span> NGX_COMPILER <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if (NGX_SSL)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(<a href="../event/ngx_event_openssl.h.html#L44" title="src/event/ngx_event_openssl.h:44">ngx_ssl_version</a>(), OPENSSL_VERSION_TEXT) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;built with &quot;</span> OPENSSL_VERSION_TEXT <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;built with &quot;</span> OPENSSL_VERSION_TEXT<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot; (running with &quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>((<span class="Type">char</span> *) (<span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span>) <a href="../event/ngx_event_openssl.h.html#L44" title="src/event/ngx_event_openssl.h:44">ngx_ssl_version</a>());<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;)&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#ifdef SSL_CTRL_SET_TLSEXT_HOSTNAME<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;TLS SNI support enabled&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;TLS SNI support disabled&quot;</span> <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L253" title="src/core/ngx_log.h:253">ngx_write_stderr</a>(<span class="Constant">&quot;configure arguments:&quot;</span> NGX_CONFIGURE <a href="../os/win32/ngx_files.h.html#L119" title="src/os/win32/ngx_files.h:119">NGX_LINEFEED</a>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L437">&#x200c;</a><span class="linkable">ngx_add_inherited_sockets</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p, *v, *inherited;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; s;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_connection.h.html#L16" title="src/core/ngx_connection.h:16">ngx_listening_t</a>&nbsp; *ls;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; inherited = (u_char *) getenv(<a href="nginx.h.html#L22" title="src/core/nginx.h:22">NGINX_VAR</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (inherited == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L22" title="src/core/ngx_log.h:22">NGX_LOG_NOTICE</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;using inherited sockets from </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, inherited);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_array.h.html#L32" title="src/core/ngx_array.h:32">ngx_array_init</a>(&amp;cycle-&gt;listening, cycle-&gt;pool, <span class="Constant">10</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="ngx_connection.h.html#L16" title="src/core/ngx_connection.h:16">ngx_listening_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p = inherited, v = p; *p; p++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p == <span class="Constant">':'</span> || *p == <span class="Constant">';'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s = <a href="ngx_string.c.html#L902" title="src/core/ngx_string.c:902">ngx_atoi</a>(v, p - v);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s == <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;invalid socket number </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> in &quot;</span> <a href="nginx.h.html#L22" title="src/core/nginx.h:22">NGINX_VAR</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot; environment variable, ignoring the rest&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot; of the variable&quot;</span>, v);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = p + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ls = <a href="ngx_array.c.html#L48" title="src/core/ngx_array.c:48">ngx_array_push</a>(&amp;cycle-&gt;listening);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ls == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(ls, <span class="Statement">sizeof</span>(<a href="ngx_connection.h.html#L16" title="src/core/ngx_connection.h:16">ngx_listening_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ls-&gt;fd = (<a href="../os/win32/ngx_socket.h.html#L19" title="src/os/win32/ngx_socket.h:19">ngx_socket_t</a>) s;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v != p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;invalid socket number </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> in &quot;</span> <a href="nginx.h.html#L22" title="src/core/nginx.h:22">NGINX_VAR</a><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot; environment variable, ignoring&quot;</span>, v);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process_cycle.c.html#L35" title="src/os/win32/ngx_process_cycle.c:35">ngx_inherited</a> = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_connection.c.html#L132" title="src/core/ngx_connection.c:132">ngx_set_inherited_sockets</a>(cycle);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">char</span> **<br/></li>
<li><a id="L496">&#x200c;</a><span class="linkable">ngx_set_environment</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle, <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> *last)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; **p, **env;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *var;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i, n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp;&nbsp; *ccf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf = (<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a> *) <a href="ngx_conf_file.h.html#L176" title="src/core/ngx_conf_file.h:176">ngx_get_conf</a>(cycle-&gt;conf_ctx, <a href="#L158" title="src/core/nginx.c:158">ngx_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (last == <span class="Constant">NULL</span> &amp;&amp; ccf-&gt;environment) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> ccf-&gt;environment;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; var = ccf-&gt;env.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; ccf-&gt;env.nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(var[i].data, <span class="Constant">&quot;TZ&quot;</span>) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="ngx_string.h.html#L53" title="src/core/ngx_string.h:53">ngx_strncmp</a>(var[i].data, <span class="Constant">&quot;TZ=&quot;</span>, <span class="Constant">3</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> tz_found;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; var = <a href="ngx_array.c.html#L48" title="src/core/ngx_array.c:48">ngx_array_push</a>(&amp;ccf-&gt;env);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (var == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; var-&gt;len = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; var-&gt;data = (u_char *) <span class="Constant">&quot;TZ&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; var = ccf-&gt;env.elts;<br/></li>
<li><br/></li>
<li><span class="Statement">tz_found</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; ccf-&gt;env.nelts; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (var[i].data[var[i].len] == <span class="Constant">'='</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = <a href="#L183" title="src/core/nginx.c:183">ngx_os_environ</a>; *p; p++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L53" title="src/core/ngx_string.h:53">ngx_strncmp</a>(*p, var[i].data, var[i].len) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (*p)[var[i].len] == <span class="Constant">'='</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; env = <a href="../os/win32/ngx_alloc.c.html#L17" title="src/os/win32/ngx_alloc.c:17">ngx_alloc</a>((*last + n + <span class="Constant">1</span>) * <span class="Statement">sizeof</span>(<span class="Type">char</span> *), cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *last = n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; env = <a href="ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(cycle-&gt;pool, (n + <span class="Constant">1</span>) * <span class="Statement">sizeof</span>(<span class="Type">char</span> *));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (env == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; ccf-&gt;env.nelts; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (var[i].data[var[i].len] == <span class="Constant">'='</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; env[n++] = (<span class="Type">char</span> *) var[i].data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = <a href="#L183" title="src/core/nginx.c:183">ngx_os_environ</a>; *p; p++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L53" title="src/core/ngx_string.h:53">ngx_strncmp</a>(*p, var[i].data, var[i].len) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (*p)[var[i].len] == <span class="Constant">'='</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; env[n++] = *p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; env[n] = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (last == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;environment = env;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; environ = env;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> env;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../os/win32/ngx_process.h.html#L12" title="src/os/win32/ngx_process.h:12">ngx_pid_t</a><br/></li>
<li><a id="L595">&#x200c;</a><span class="linkable">ngx_exec_new_binary</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle, <span class="Type">char</span> *<span class="Type">const</span> *argv)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; **env, *var;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i, n;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.h.html#L12" title="src/os/win32/ngx_process.h:12">ngx_pid_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pid;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.h.html#L52" title="src/os/win32/ngx_process.h:52">ngx_exec_ctx_t</a>&nbsp; &nbsp;&nbsp; ctx;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp;&nbsp; *ccf;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_connection.h.html#L16" title="src/core/ngx_connection.h:16">ngx_listening_t</a>&nbsp;&nbsp; *ls;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L86" title="src/core/ngx_string.h:86">ngx_memzero</a>(&amp;ctx, <span class="Statement">sizeof</span>(<a href="../os/win32/ngx_process.h.html#L52" title="src/os/win32/ngx_process.h:52">ngx_exec_ctx_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ctx.path = argv[<span class="Constant">0</span>];<br/></li>
<li>&nbsp; &nbsp; ctx.name = <span class="Constant">&quot;new binary process&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; ctx.argv = argv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; env = <a href="#L496" title="src/core/nginx.c:496">ngx_set_environment</a>(cycle, &amp;n);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (env == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../os/win32/ngx_process.h.html#L13" title="src/os/win32/ngx_process.h:13">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; var = <a href="../os/win32/ngx_alloc.c.html#L17" title="src/os/win32/ngx_alloc.c:17">ngx_alloc</a>(<span class="Statement">sizeof</span>(<a href="nginx.h.html#L22" title="src/core/nginx.h:22">NGINX_VAR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + cycle-&gt;listening.nelts * (<a href="ngx_config.h.html#L83" title="src/core/ngx_config.h:83">NGX_INT32_LEN</a> + <span class="Constant">1</span>) + <span class="Constant">2</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (var == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_alloc.h.html#L19" title="src/os/win32/ngx_alloc.h:19">ngx_free</a>(env);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../os/win32/ngx_process.h.html#L13" title="src/os/win32/ngx_process.h:13">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_string.h.html#L93" title="src/core/ngx_string.h:93">ngx_cpymem</a>(var, <a href="nginx.h.html#L22" title="src/core/nginx.h:22">NGINX_VAR</a> <span class="Constant">&quot;=&quot;</span>, <span class="Statement">sizeof</span>(<a href="nginx.h.html#L22" title="src/core/nginx.h:22">NGINX_VAR</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ls = cycle-&gt;listening.elts;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cycle-&gt;listening.nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_string.c.html#L105" title="src/core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">d;&quot;</span>, ls[i].fd);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *p = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; env[n++] = var;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (<a href="../os/unix/ngx_setproctitle.h.html#L26" title="src/os/unix/ngx_setproctitle.h:26">NGX_SETPROCTITLE_USES_ENV</a>)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* allocate the spare 300 bytes for the new binary process title */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; env[n++] = <span class="Constant">&quot;SPARE=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; env[n] = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_DEBUG)<br/></li>
<li></span>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; **e;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (e = env; *e; e++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L139" title="src/core/ngx_log.h:139">ngx_log_debug1</a>(<a href="ngx_log.h.html#L26" title="src/core/ngx_log.h:26">NGX_LOG_DEBUG_CORE</a>, cycle-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;env: </span><span class="Special">%s</span><span class="Constant">&quot;</span>, *e);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; ctx.envp = (<span class="Type">char</span> *<span class="Type">const</span> *) env;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf = (<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a> *) <a href="ngx_conf_file.h.html#L176" title="src/core/ngx_conf_file.h:176">ngx_get_conf</a>(cycle-&gt;conf_ctx, <a href="#L158" title="src/core/nginx.c:158">ngx_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_files.h.html#L126" title="src/os/win32/ngx_files.h:126">ngx_rename_file</a>(ccf-&gt;pid.data, ccf-&gt;oldpid.data) == <a href="../os/win32/ngx_files.h.html#L69" title="src/os/win32/ngx_files.h:69">NGX_FILE_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L18" title="src/core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_files.h.html#L127" title="src/os/win32/ngx_files.h:127">ngx_rename_file_n</a> <span class="Constant">&quot; </span><span class="Special">%s</span><span class="Constant"> to </span><span class="Special">%s</span><span class="Constant"> failed &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;before executing new binary process </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;pid.data, ccf-&gt;oldpid.data, argv[<span class="Constant">0</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_alloc.h.html#L19" title="src/os/win32/ngx_alloc.h:19">ngx_free</a>(env);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_alloc.h.html#L19" title="src/os/win32/ngx_alloc.h:19">ngx_free</a>(var);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../os/win32/ngx_process.h.html#L13" title="src/os/win32/ngx_process.h:13">NGX_INVALID_PID</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; pid = <a href="../os/win32/ngx_process.c.html#L207" title="src/os/win32/ngx_process.c:207">ngx_execute</a>(cycle, &amp;ctx);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (pid == <a href="../os/win32/ngx_process.h.html#L13" title="src/os/win32/ngx_process.h:13">NGX_INVALID_PID</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_files.h.html#L126" title="src/os/win32/ngx_files.h:126">ngx_rename_file</a>(ccf-&gt;oldpid.data, ccf-&gt;pid.data)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; == <a href="../os/win32/ngx_files.h.html#L69" title="src/os/win32/ngx_files.h:69">NGX_FILE_ERROR</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L18" title="src/core/ngx_log.h:18">NGX_LOG_ALERT</a>, cycle-&gt;log, <a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_files.h.html#L127" title="src/os/win32/ngx_files.h:127">ngx_rename_file_n</a> <span class="Constant">&quot; </span><span class="Special">%s</span><span class="Constant"> back to </span><span class="Special">%s</span><span class="Constant"> failed after &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;an attempt to execute new binary process </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;oldpid.data, ccf-&gt;pid.data, argv[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_alloc.h.html#L19" title="src/os/win32/ngx_alloc.h:19">ngx_free</a>(env);<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_alloc.h.html#L19" title="src/os/win32/ngx_alloc.h:19">ngx_free</a>(var);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> pid;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L696">&#x200c;</a><span class="linkable">ngx_get_options</span>(<span class="Type">int</span> argc, <span class="Type">char</span> *<span class="Type">const</span> *argv)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp;&nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt; argc; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = (u_char *) argv[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p++ != <span class="Constant">'-'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;invalid option: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, argv[i]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*p) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (*p++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'?'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'h'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L175" title="src/core/nginx.c:175">ngx_show_version</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L174" title="src/core/nginx.c:174">ngx_show_help</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'v'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L175" title="src/core/nginx.c:175">ngx_show_version</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'V'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L175" title="src/core/nginx.c:175">ngx_show_version</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L176" title="src/core/nginx.c:176">ngx_show_configure</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'t'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_cycle.c.html#L26" title="src/core/ngx_cycle.c:26">ngx_test_config</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'T'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_cycle.c.html#L26" title="src/core/ngx_cycle.c:26">ngx_test_config</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_cycle.c.html#L27" title="src/core/ngx_cycle.c:27">ngx_dump_config</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'q'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_cycle.c.html#L28" title="src/core/ngx_cycle.c:28">ngx_quiet_mode</a> = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'p'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L177" title="src/core/nginx.c:177">ngx_prefix</a> = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (argv[++i]) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L177" title="src/core/nginx.c:177">ngx_prefix</a> = (u_char *) argv[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;option </span><span class="Special">\&quot;</span><span class="Constant">-p</span><span class="Special">\&quot;</span><span class="Constant"> requires directory name&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'c'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L178" title="src/core/nginx.c:178">ngx_conf_file</a> = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (argv[++i]) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L178" title="src/core/nginx.c:178">ngx_conf_file</a> = (u_char *) argv[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;option </span><span class="Special">\&quot;</span><span class="Constant">-c</span><span class="Special">\&quot;</span><span class="Constant"> requires file name&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'g'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L179" title="src/core/nginx.c:179">ngx_conf_params</a> = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (argv[++i]) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L179" title="src/core/nginx.c:179">ngx_conf_params</a> = (u_char *) argv[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;option </span><span class="Special">\&quot;</span><span class="Constant">-g</span><span class="Special">\&quot;</span><span class="Constant"> requires parameter&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'s'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L180" title="src/core/nginx.c:180">ngx_signal</a> = (<span class="Type">char</span> *) p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (argv[++i]) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L180" title="src/core/nginx.c:180">ngx_signal</a> = argv[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;option </span><span class="Special">\&quot;</span><span class="Constant">-s</span><span class="Special">\&quot;</span><span class="Constant"> requires parameter&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(<a href="#L180" title="src/core/nginx.c:180">ngx_signal</a>, <span class="Constant">&quot;stop&quot;</span>) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(<a href="#L180" title="src/core/nginx.c:180">ngx_signal</a>, <span class="Constant">&quot;quit&quot;</span>) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(<a href="#L180" title="src/core/nginx.c:180">ngx_signal</a>, <span class="Constant">&quot;reopen&quot;</span>) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(<a href="#L180" title="src/core/nginx.c:180">ngx_signal</a>, <span class="Constant">&quot;reload&quot;</span>) == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_process_cycle.c.html#L31" title="src/os/win32/ngx_process_cycle.c:31">ngx_process</a> = <a href="../os/win32/ngx_process_cycle.h.html#L18" title="src/os/win32/ngx_process_cycle.h:18">NGX_PROCESS_SIGNALLER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;invalid option: </span><span class="Special">\&quot;</span><span class="Constant">-s </span><span class="Special">%s\&quot;</span><span class="Constant">&quot;</span>, <a href="#L180" title="src/core/nginx.c:180">ngx_signal</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<span class="Constant">0</span>, <span class="Constant">&quot;invalid option: </span><span class="Special">\&quot;%c\&quot;</span><span class="Constant">&quot;</span>, *(p - <span class="Constant">1</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">next</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L824">&#x200c;</a><span class="linkable">ngx_save_argv</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle, <span class="Type">int</span> argc, <span class="Type">char</span> *<span class="Type">const</span> *argv)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if (NGX_FREEBSD)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L14" title="src/os/win32/ngx_process.c:14">ngx_os_argv</a> = (<span class="Type">char</span> **) argv;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L12" title="src/os/win32/ngx_process.c:12">ngx_argc</a> = argc;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L13" title="src/os/win32/ngx_process.c:13">ngx_argv</a> = (<span class="Type">char</span> **) argv;<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L14" title="src/os/win32/ngx_process.c:14">ngx_os_argv</a> = (<span class="Type">char</span> **) argv;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L12" title="src/os/win32/ngx_process.c:12">ngx_argc</a> = argc;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L13" title="src/os/win32/ngx_process.c:13">ngx_argv</a> = <a href="../os/win32/ngx_alloc.c.html#L17" title="src/os/win32/ngx_alloc.c:17">ngx_alloc</a>((argc + <span class="Constant">1</span>) * <span class="Statement">sizeof</span>(<span class="Type">char</span> *), cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_process.c.html#L13" title="src/os/win32/ngx_process.c:13">ngx_argv</a> == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; argc; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_string.h.html#L61" title="src/core/ngx_string.h:61">ngx_strlen</a>(argv[i]) + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L13" title="src/os/win32/ngx_process.c:13">ngx_argv</a>[i] = <a href="../os/win32/ngx_alloc.c.html#L17" title="src/os/win32/ngx_alloc.c:17">ngx_alloc</a>(len, cycle-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_process.c.html#L13" title="src/os/win32/ngx_process.c:13">ngx_argv</a>[i] == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span>) <a href="ngx_string.c.html#L33" title="src/core/ngx_string.c:33">ngx_cpystrn</a>((u_char *) <a href="../os/win32/ngx_process.c.html#L13" title="src/os/win32/ngx_process.c:13">ngx_argv</a>[i], (u_char *) argv[i], len);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.c.html#L13" title="src/os/win32/ngx_process.c:13">ngx_argv</a>[i] = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="#L183" title="src/core/nginx.c:183">ngx_os_environ</a> = environ;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L866">&#x200c;</a><span class="linkable">ngx_process_options</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp;&nbsp; len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L177" title="src/core/nginx.c:177">ngx_prefix</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_string.h.html#L61" title="src/core/ngx_string.h:61">ngx_strlen</a>(<a href="#L177" title="src/core/nginx.c:177">ngx_prefix</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="#L177" title="src/core/nginx.c:177">ngx_prefix</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &amp;&amp; !<a href="../os/win32/ngx_files.h.html#L179" title="src/os/win32/ngx_files.h:179">ngx_path_separator</a>(p[len - <span class="Constant">1</span>])) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(cycle-&gt;pool, len + <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.c.html#L1966" title="src/core/ngx_string.c:1966">ngx_memcpy</a>(p, <a href="#L177" title="src/core/nginx.c:177">ngx_prefix</a>, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p[len++] = <span class="Constant">'/'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_prefix.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_prefix.data = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;prefix.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;prefix.data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li><br/></li>
<li><span class="PreProc">#ifndef NGX_PREFIX<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(cycle-&gt;pool, <a href="../os/win32/ngx_files.h.html#L182" title="src/os/win32/ngx_files.h:182">NGX_MAX_PATH</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_files.h.html#L177" title="src/os/win32/ngx_files.h:177">ngx_getcwd</a>(p, <a href="../os/win32/ngx_files.h.html#L182" title="src/os/win32/ngx_files.h:182">NGX_MAX_PATH</a>) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L259" title="src/core/ngx_log.c:259">ngx_log_stderr</a>(<a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>, <span class="Constant">&quot;[emerg]: &quot;</span> <a href="../os/win32/ngx_files.h.html#L178" title="src/os/win32/ngx_files.h:178">ngx_getcwd_n</a> <span class="Constant">&quot; failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_string.h.html#L61" title="src/core/ngx_string.h:61">ngx_strlen</a>(p);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p[len++] = <span class="Constant">'/'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_prefix.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_prefix.data = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;prefix.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;prefix.data = p;<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#ifdef NGX_CONF_PREFIX<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L42" title="src/core/ngx_string.h:42">ngx_str_set</a>(&amp;cycle-&gt;conf_prefix, NGX_CONF_PREFIX);<br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L42" title="src/core/ngx_string.h:42">ngx_str_set</a>(&amp;cycle-&gt;conf_prefix, NGX_PREFIX);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L42" title="src/core/ngx_string.h:42">ngx_str_set</a>(&amp;cycle-&gt;prefix, NGX_PREFIX);<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L178" title="src/core/nginx.c:178">ngx_conf_file</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_file.len = <a href="ngx_string.h.html#L61" title="src/core/ngx_string.h:61">ngx_strlen</a>(<a href="#L178" title="src/core/nginx.c:178">ngx_conf_file</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_file.data = <a href="#L178" title="src/core/nginx.c:178">ngx_conf_file</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L42" title="src/core/ngx_string.h:42">ngx_str_set</a>(&amp;cycle-&gt;conf_file, NGX_CONF_PATH);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_conf_file.c.html#L845" title="src/core/ngx_conf_file.c:845">ngx_conf_full_name</a>(cycle, &amp;cycle-&gt;conf_file, <span class="Constant">0</span>) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p = cycle-&gt;conf_file.data + cycle-&gt;conf_file.len - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p &gt; cycle-&gt;conf_file.data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p--)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_files.h.html#L179" title="src/os/win32/ngx_files.h:179">ngx_path_separator</a>(*p)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_prefix.len = p - <a href="ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_file.data + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_prefix.data = <a href="ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_file.data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L179" title="src/core/nginx.c:179">ngx_conf_params</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_param.len = <a href="ngx_string.h.html#L61" title="src/core/ngx_string.h:61">ngx_strlen</a>(<a href="#L179" title="src/core/nginx.c:179">ngx_conf_params</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;conf_param.data = <a href="#L179" title="src/core/nginx.c:179">ngx_conf_params</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_cycle.c.html#L26" title="src/core/ngx_cycle.c:26">ngx_test_config</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;log-&gt;log_level = <a href="ngx_log.h.html#L23" title="src/core/ngx_log.h:23">NGX_LOG_INFO</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<br/></li>
<li><a id="L962">&#x200c;</a><span class="linkable">ngx_core_module_create_conf</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf = <a href="ngx_palloc.c.html#L301" title="src/core/ngx_palloc.c:301">ngx_pcalloc</a>(cycle-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * set by <a href="ngx_palloc.c.html#L301" title="src/core/ngx_palloc.c:301">ngx_pcalloc</a>()<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; ccf-&gt;pid = NULL;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; ccf-&gt;oldpid = NULL;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; ccf-&gt;priority = 0;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; ccf-&gt;cpu_affinity_auto = 0;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; ccf-&gt;cpu_affinity_n = 0;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; ccf-&gt;cpu_affinity = NULL;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;daemon = <a href="ngx_conf_file.h.html#L56" title="src/core/ngx_conf_file.h:56">NGX_CONF_UNSET</a>;<br/></li>
<li>&nbsp; &nbsp; ccf-&gt;master = <a href="ngx_conf_file.h.html#L56" title="src/core/ngx_conf_file.h:56">NGX_CONF_UNSET</a>;<br/></li>
<li>&nbsp; &nbsp; ccf-&gt;timer_resolution = <a href="ngx_conf_file.h.html#L60" title="src/core/ngx_conf_file.h:60">NGX_CONF_UNSET_MSEC</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;worker_processes = <a href="ngx_conf_file.h.html#L56" title="src/core/ngx_conf_file.h:56">NGX_CONF_UNSET</a>;<br/></li>
<li>&nbsp; &nbsp; ccf-&gt;debug_points = <a href="ngx_conf_file.h.html#L56" title="src/core/ngx_conf_file.h:56">NGX_CONF_UNSET</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;rlimit_nofile = <a href="ngx_conf_file.h.html#L56" title="src/core/ngx_conf_file.h:56">NGX_CONF_UNSET</a>;<br/></li>
<li>&nbsp; &nbsp; ccf-&gt;rlimit_core = <a href="ngx_conf_file.h.html#L56" title="src/core/ngx_conf_file.h:56">NGX_CONF_UNSET</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;user = (<a href="../os/win32/ngx_user.h.html#L17" title="src/os/win32/ngx_user.h:17">ngx_uid_t</a>) <a href="ngx_conf_file.h.html#L57" title="src/core/ngx_conf_file.h:57">NGX_CONF_UNSET_UINT</a>;<br/></li>
<li>&nbsp; &nbsp; ccf-&gt;group = (<a href="../os/win32/ngx_user.h.html#L18" title="src/os/win32/ngx_user.h:18">ngx_gid_t</a>) <a href="ngx_conf_file.h.html#L57" title="src/core/ngx_conf_file.h:57">NGX_CONF_UNSET_UINT</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_array.h.html#L32" title="src/core/ngx_array.h:32">ngx_array_init</a>(&amp;ccf-&gt;env, cycle-&gt;pool, <span class="Constant">1</span>, <span class="Statement">sizeof</span>(<a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> ccf;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1006">&#x200c;</a><span class="linkable">ngx_core_module_init_conf</span>(<a href="ngx_core.h.html#L17" title="src/core/ngx_core.h:17">ngx_cycle_t</a> *cycle, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.h.html#L180" title="src/core/ngx_conf_file.h:180">ngx_conf_init_value</a>(ccf-&gt;daemon, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.h.html#L180" title="src/core/ngx_conf_file.h:180">ngx_conf_init_value</a>(ccf-&gt;master, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.h.html#L200" title="src/core/ngx_conf_file.h:200">ngx_conf_init_msec_value</a>(ccf-&gt;timer_resolution, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.h.html#L180" title="src/core/ngx_conf_file.h:180">ngx_conf_init_value</a>(ccf-&gt;worker_processes, <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.h.html#L180" title="src/core/ngx_conf_file.h:180">ngx_conf_init_value</a>(ccf-&gt;debug_points, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (<a href="../os/unix/ngx_setaffinity.h.html#L12" title="src/os/unix/ngx_setaffinity.h:12">NGX_HAVE_CPU_AFFINITY</a>)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (!ccf-&gt;cpu_affinity_auto<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; ccf-&gt;cpu_affinity_n<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; ccf-&gt;cpu_affinity_n != <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; ccf-&gt;cpu_affinity_n != (<a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>) ccf-&gt;worker_processes)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L21" title="src/core/ngx_log.h:21">NGX_LOG_WARN</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;the number of </span><span class="Special">\&quot;</span><span class="Constant">worker_processes</span><span class="Special">\&quot;</span><span class="Constant"> is not equal to &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;the number of </span><span class="Special">\&quot;</span><span class="Constant">worker_cpu_affinity</span><span class="Special">\&quot;</span><span class="Constant"> masks, &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;using last mask for remaining worker processes&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;pid.len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L42" title="src/core/ngx_string.h:42">ngx_str_set</a>(&amp;ccf-&gt;pid, NGX_PID_PATH);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_conf_file.c.html#L845" title="src/core/ngx_conf_file.c:845">ngx_conf_full_name</a>(cycle, &amp;ccf-&gt;pid, <span class="Constant">0</span>) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;oldpid.len = ccf-&gt;pid.len + <span class="Statement">sizeof</span>(<a href="nginx.h.html#L23" title="src/core/nginx.h:23">NGX_OLDPID_EXT</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;oldpid.data = <a href="ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(cycle-&gt;pool, ccf-&gt;oldpid.len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;oldpid.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.c.html#L1966" title="src/core/ngx_string.c:1966">ngx_memcpy</a>(<a href="ngx_string.h.html#L93" title="src/core/ngx_string.h:93">ngx_cpymem</a>(ccf-&gt;oldpid.data, ccf-&gt;pid.data, ccf-&gt;pid.len),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="nginx.h.html#L23" title="src/core/nginx.h:23">NGX_OLDPID_EXT</a>, <span class="Statement">sizeof</span>(<a href="nginx.h.html#L23" title="src/core/nginx.h:23">NGX_OLDPID_EXT</a>));<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if !(NGX_WIN32)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;user == (uid_t) <a href="ngx_conf_file.h.html#L57" title="src/core/ngx_conf_file.h:57">NGX_CONF_UNSET_UINT</a> &amp;&amp; geteuid() == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> group&nbsp;&nbsp; *grp;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Type">struct</span> passwd&nbsp; *pwd;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_errno.h.html#L19" title="src/os/win32/ngx_errno.h:19">ngx_set_errno</a>(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; pwd = getpwnam(NGX_USER);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (pwd == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cycle-&gt;log, <a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;getpwnam(</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span> NGX_USER <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;username = NGX_USER;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;user = pwd-&gt;pw_uid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_errno.h.html#L19" title="src/os/win32/ngx_errno.h:19">ngx_set_errno</a>(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; grp = getgrnam(NGX_GROUP);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (grp == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cycle-&gt;log, <a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;getgrnam(</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span> NGX_GROUP <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">) failed&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;group = grp-&gt;gr_gid;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;lock_file.len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L42" title="src/core/ngx_string.h:42">ngx_str_set</a>(&amp;ccf-&gt;lock_file, NGX_LOCK_PATH);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_conf_file.c.html#L845" title="src/core/ngx_conf_file.c:845">ngx_conf_full_name</a>(cycle, &amp;ccf-&gt;lock_file, <span class="Constant">0</span>) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; lock_file;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; lock_file = cycle-&gt;old_cycle-&gt;lock_file;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (lock_file.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lock_file.len--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;lock_file.len != lock_file.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="ngx_string.h.html#L53" title="src/core/ngx_string.h:53">ngx_strncmp</a>(ccf-&gt;lock_file.data, lock_file.data, lock_file.len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cycle-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">lock_file</span><span class="Special">\&quot;</span><span class="Constant"> could not be changed, ignored&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;lock_file.len = lock_file.len + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; lock_file.len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;.accept&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;lock_file.data = <a href="ngx_string.c.html#L57" title="src/core/ngx_string.c:57">ngx_pstrdup</a>(cycle-&gt;pool, &amp;lock_file);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cycle-&gt;lock_file.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;lock_file.len = ccf-&gt;lock_file.len + <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cycle-&gt;lock_file.data = <a href="ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(cycle-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;lock_file.len + <span class="Statement">sizeof</span>(<span class="Constant">&quot;.accept&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cycle-&gt;lock_file.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.c.html#L1966" title="src/core/ngx_string.c:1966">ngx_memcpy</a>(<a href="ngx_string.h.html#L93" title="src/core/ngx_string.h:93">ngx_cpymem</a>(cycle-&gt;lock_file.data, ccf-&gt;lock_file.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;lock_file.len),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;.accept&quot;</span>, <span class="Statement">sizeof</span>(<span class="Constant">&quot;.accept&quot;</span>));<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1134">&#x200c;</a><span class="linkable">ngx_set_user</span>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if (NGX_WIN32)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L21" title="src/core/ngx_log.h:21">NGX_LOG_WARN</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">user</span><span class="Special">\&quot;</span><span class="Constant"> is not supported, ignored&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *group;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> passwd&nbsp; &nbsp; *pwd;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> group&nbsp; &nbsp;&nbsp; *grp;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;user != (uid_t) <a href="ngx_conf_file.h.html#L57" title="src/core/ngx_conf_file.h:57">NGX_CONF_UNSET_UINT</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;is duplicate&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (geteuid() != <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L21" title="src/core/ngx_log.h:21">NGX_LOG_WARN</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;the </span><span class="Special">\&quot;</span><span class="Constant">user</span><span class="Special">\&quot;</span><span class="Constant"> directive makes sense only &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;if the master process runs &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;with super-user privileges, ignored&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;username = (<span class="Type">char</span> *) value[<span class="Constant">1</span>].data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_errno.h.html#L19" title="src/os/win32/ngx_errno.h:19">ngx_set_errno</a>(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; pwd = getpwnam((<span class="Type">const</span> <span class="Type">char</span> *) value[<span class="Constant">1</span>].data);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (pwd == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;getpwnam(</span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">) failed&quot;</span>, value[<span class="Constant">1</span>].data);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;user = pwd-&gt;pw_uid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; group = (<span class="Type">char</span> *) ((cf-&gt;args-&gt;nelts == <span class="Constant">2</span>) ? value[<span class="Constant">1</span>].data : value[<span class="Constant">2</span>].data);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_errno.h.html#L19" title="src/os/win32/ngx_errno.h:19">ngx_set_errno</a>(<span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; grp = getgrnam(group);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (grp == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <a href="../os/win32/ngx_errno.h.html#L18" title="src/os/win32/ngx_errno.h:18">ngx_errno</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;getgrnam(</span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">) failed&quot;</span>, group);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;group = grp-&gt;gr_gid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1197">&#x200c;</a><span class="linkable">ngx_set_env</span>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp;&nbsp; *value, *var;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; var = <a href="ngx_array.c.html#L48" title="src/core/ngx_array.c:48">ngx_array_push</a>(&amp;ccf-&gt;env);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (var == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li>&nbsp; &nbsp; *var = value[<span class="Constant">1</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; value[<span class="Constant">1</span>].len; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (value[<span class="Constant">1</span>].data[i] == <span class="Constant">'='</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var-&gt;len = i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1227">&#x200c;</a><span class="linkable">ngx_set_priority</span>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; n, minus;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;priority != <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;is duplicate&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value[<span class="Constant">1</span>].data[<span class="Constant">0</span>] == <span class="Constant">'-'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; minus = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (value[<span class="Constant">1</span>].data[<span class="Constant">0</span>] == <span class="Constant">'+'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; minus = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; minus = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;priority = <a href="ngx_string.c.html#L902" title="src/core/ngx_string.c:902">ngx_atoi</a>(&amp;value[<span class="Constant">1</span>].data[n], value[<span class="Constant">1</span>].len - n);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;priority == <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;invalid number&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (minus) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;priority = -ccf-&gt;priority;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1267">&#x200c;</a><span class="linkable">ngx_set_cpu_affinity</span>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if (<a href="../os/unix/ngx_setaffinity.h.html#L12" title="src/os/unix/ngx_setaffinity.h:12">NGX_HAVE_CPU_AFFINITY</a>)<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch, *p;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; i, n;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.h.html#L24" title="src/os/win32/ngx_process.h:24">ngx_cpuset_t</a>&nbsp; &nbsp;&nbsp; *mask;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;cpu_affinity) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;is duplicate&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; mask = <a href="ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(cf-&gt;pool, (cf-&gt;args-&gt;nelts - <span class="Constant">1</span>) * <span class="Statement">sizeof</span>(<a href="../os/win32/ngx_process.h.html#L24" title="src/os/win32/ngx_process.h:24">ngx_cpuset_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (mask == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;cpu_affinity_n = cf-&gt;args-&gt;nelts - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; ccf-&gt;cpu_affinity = mask;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(value[<span class="Constant">1</span>].data, <span class="Constant">&quot;auto&quot;</span>) == <span class="Constant">0</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;args-&gt;nelts &gt; <span class="Constant">3</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;invalid number of arguments in &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">worker_cpu_affinity</span><span class="Special">\&quot;</span><span class="Constant"> directive&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;cpu_affinity_auto = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; CPU_ZERO(&amp;mask[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; (<a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>) <a href="ngx_core.h.html#L102" title="src/core/ngx_core.h:102">ngx_min</a>(<a href="../os/win32/ngx_win32_init.c.html#L14" title="src/os/win32/ngx_win32_init.c:14">ngx_ncpu</a>, CPU_SETSIZE); i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU_SET(i, &amp;mask[<span class="Constant">0</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( <span class="Comment">/* void */</span> ; n &lt; cf-&gt;args-&gt;nelts; n++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (value[n].len &gt; CPU_SETSIZE) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">worker_cpu_affinity</span><span class="Special">\&quot;</span><span class="Constant"> supports up to </span><span class="Special">%d</span><span class="Constant"> CPUs only&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; CPU_SETSIZE);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; CPU_ZERO(&amp;mask[n - <span class="Constant">1</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p = value[n].data + value[n].len - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p &gt;= value[n].data;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p--)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">' '</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'0'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'1'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU_SET(i - <span class="Constant">1</span>, &amp;mask[n - <span class="Constant">1</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;invalid character </span><span class="Special">\&quot;%c\&quot;</span><span class="Constant"> in </span><span class="Special">\&quot;</span><span class="Constant">worker_cpu_affinity</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L21" title="src/core/ngx_log.h:21">NGX_LOG_WARN</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">worker_cpu_affinity</span><span class="Special">\&quot;</span><span class="Constant"> is not supported &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;on this platform, ignored&quot;</span>);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../os/win32/ngx_process.h.html#L24" title="src/os/win32/ngx_process.h:24">ngx_cpuset_t</a> *<br/></li>
<li><a id="L1365">&#x200c;</a><span class="linkable">ngx_get_cpu_affinity</span>(<a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> n)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if (<a href="../os/unix/ngx_setaffinity.h.html#L12" title="src/os/unix/ngx_setaffinity.h:12">NGX_HAVE_CPU_AFFINITY</a>)<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; i, j;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/win32/ngx_process.h.html#L24" title="src/os/win32/ngx_process.h:24">ngx_cpuset_t</a>&nbsp; &nbsp;&nbsp; *mask;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <a href="../os/win32/ngx_process.h.html#L24" title="src/os/win32/ngx_process.h:24">ngx_cpuset_t</a>&nbsp; result;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf = (<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a> *) <a href="ngx_conf_file.h.html#L176" title="src/core/ngx_conf_file.h:176">ngx_get_conf</a>(<a href="ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;conf_ctx,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L158" title="src/core/nginx.c:158">ngx_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;cpu_affinity == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;cpu_affinity_auto) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; mask = &amp;ccf-&gt;cpu_affinity[ccf-&gt;cpu_affinity_n - <span class="Constant">1</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>, j = n; <span class="Comment">/* void */</span> ; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (CPU_ISSET(i % CPU_SETSIZE, mask) &amp;&amp; j-- == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i == CPU_SETSIZE &amp;&amp; j == n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* empty mask */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* void */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; CPU_ZERO(&amp;result);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; CPU_SET(i % CPU_SETSIZE, &amp;result);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> &amp;result;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;cpu_affinity_n &gt; n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> &amp;ccf-&gt;cpu_affinity[n];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> &amp;ccf-&gt;cpu_affinity[ccf-&gt;cpu_affinity_n - <span class="Constant">1</span>];<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1419">&#x200c;</a><span class="linkable">ngx_set_worker_processes</span>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a>&nbsp; *ccf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf = (<a href="ngx_cycle.h.html#L111" title="src/core/ngx_cycle.h:111">ngx_core_conf_t</a> *) conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;worker_processes != <a href="ngx_conf_file.h.html#L56" title="src/core/ngx_conf_file.h:56">NGX_CONF_UNSET</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;is duplicate&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L57" title="src/core/ngx_string.h:57">ngx_strcmp</a>(value[<span class="Constant">1</span>].data, <span class="Constant">&quot;auto&quot;</span>) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ccf-&gt;worker_processes = <a href="../os/win32/ngx_win32_init.c.html#L14" title="src/os/win32/ngx_win32_init.c:14">ngx_ncpu</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ccf-&gt;worker_processes = <a href="ngx_string.c.html#L902" title="src/core/ngx_string.c:902">ngx_atoi</a>(value[<span class="Constant">1</span>].data, value[<span class="Constant">1</span>].len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (ccf-&gt;worker_processes == <a href="ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;invalid value&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L1448">&#x200c;</a><span class="linkable">ngx_load_module</span>(<a href="ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="ngx_core.h.html#L22" title="src/core/ngx_core.h:22">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if (<a href="../os/win32/ngx_dlopen.h.html#L16" title="src/os/win32/ngx_dlopen.h:16">NGX_HAVE_DLOPEN</a>)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *handle;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">char</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; **names, **order;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *value, file;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_core.h.html#L15" title="src/core/ngx_core.h:15">ngx_module_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *module, **modules;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_palloc.h.html#L32" title="src/core/ngx_palloc.h:32">ngx_pool_cleanup_t</a>&nbsp; *cln;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;cycle-&gt;modules_used) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">&quot;is specified too late&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; file = value[<span class="Constant">1</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_conf_file.c.html#L845" title="src/core/ngx_conf_file.c:845">ngx_conf_full_name</a>(cf-&gt;cycle, &amp;file, <span class="Constant">0</span>) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cln = <a href="ngx_palloc.c.html#L315" title="src/core/ngx_palloc.c:315">ngx_pool_cleanup_add</a>(cf-&gt;cycle-&gt;pool, <span class="Constant">0</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cln == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; handle = <a href="../os/win32/ngx_dlopen.h.html#L19" title="src/os/win32/ngx_dlopen.h:19">ngx_dlopen</a>(file.data);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (handle == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/win32/ngx_dlopen.h.html#L20" title="src/os/win32/ngx_dlopen.h:20">ngx_dlopen_n</a> <span class="Constant">&quot; </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> failed (</span><span class="Special">%s</span><span class="Constant">)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; file.data, <a href="../os/win32/ngx_dlopen.c.html#L13" title="src/os/win32/ngx_dlopen.c:13">ngx_dlerror</a>());<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cln-&gt;handler = <a href="#L1532" title="src/core/nginx.c:1532">ngx_unload_module</a>;<br/></li>
<li>&nbsp; &nbsp; cln-&gt;data = handle;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; modules = <a href="../os/win32/ngx_dlopen.h.html#L22" title="src/os/win32/ngx_dlopen.h:22">ngx_dlsym</a>(handle, <span class="Constant">&quot;ngx_modules&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (modules == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/win32/ngx_dlopen.h.html#L23" title="src/os/win32/ngx_dlopen.h:23">ngx_dlsym_n</a> <span class="Constant">&quot; </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">, </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> failed (</span><span class="Special">%s</span><span class="Constant">)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;value[<span class="Constant">1</span>], <span class="Constant">&quot;ngx_modules&quot;</span>, <a href="../os/win32/ngx_dlopen.c.html#L13" title="src/os/win32/ngx_dlopen.c:13">ngx_dlerror</a>());<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; names = <a href="../os/win32/ngx_dlopen.h.html#L22" title="src/os/win32/ngx_dlopen.h:22">ngx_dlsym</a>(handle, <span class="Constant">&quot;ngx_module_names&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (names == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../os/win32/ngx_dlopen.h.html#L23" title="src/os/win32/ngx_dlopen.h:23">ngx_dlsym_n</a> <span class="Constant">&quot; </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">, </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant"> failed (</span><span class="Special">%s</span><span class="Constant">)&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;value[<span class="Constant">1</span>], <span class="Constant">&quot;ngx_module_names&quot;</span>, <a href="../os/win32/ngx_dlopen.c.html#L13" title="src/os/win32/ngx_dlopen.c:13">ngx_dlerror</a>());<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; order = <a href="../os/win32/ngx_dlopen.h.html#L22" title="src/os/win32/ngx_dlopen.h:22">ngx_dlsym</a>(handle, <span class="Constant">&quot;ngx_module_order&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; modules[i]; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; module = modules[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; module-&gt;name = names[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_module.c.html#L157" title="src/core/ngx_module.c:157">ngx_add_module</a>(cf, &amp;file, module, order) != <a href="ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L142" title="src/core/ngx_log.h:142">ngx_log_debug2</a>(<a href="ngx_log.h.html#L26" title="src/core/ngx_log.h:26">NGX_LOG_DEBUG_CORE</a>, cf-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;module: </span><span class="Special">%s</span><span class="Constant"> i:</span><span class="Special">%u</span><span class="Constant">i&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; module-&gt;name, module-&gt;index);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L63" title="src/core/ngx_conf_file.h:63">NGX_CONF_OK</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;</span><span class="Special">\&quot;</span><span class="Constant">load_module</span><span class="Special">\&quot;</span><span class="Constant"> is not supported &quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;on this platform&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_conf_file.h.html#L64" title="src/core/ngx_conf_file.h:64">NGX_CONF_ERROR</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (<a href="../os/win32/ngx_dlopen.h.html#L16" title="src/os/win32/ngx_dlopen.h:16">NGX_HAVE_DLOPEN</a>)<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1532">&#x200c;</a></span><span class="linkable">ngx_unload_module</span>(<span class="Type">void</span> *data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; *handle = data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../os/win32/ngx_dlopen.h.html#L25" title="src/os/win32/ngx_dlopen.h:25">ngx_dlclose</a>(handle) != <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="ngx_log.h.html#L18" title="src/core/ngx_log.h:18">NGX_LOG_ALERT</a>, <a href="ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/win32/ngx_dlopen.h.html#L26" title="src/os/win32/ngx_dlopen.h:26">ngx_dlclose_n</a> <span class="Constant">&quot; failed (</span><span class="Special">%s</span><span class="Constant">)&quot;</span>, <a href="../os/win32/ngx_dlopen.c.html#L13" title="src/os/win32/ngx_dlopen.c:13">ngx_dlerror</a>());<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
