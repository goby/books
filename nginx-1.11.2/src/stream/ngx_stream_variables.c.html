<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>src/stream/ngx_stream_variables.c - Nginx 1.11.2</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>src/stream/ngx_stream_variables.c - Nginx 1.11.2</h1>
 <h2>Global variables defined</h2>
 <ul class="toc">
<li><a href="#L43">ngx_stream_core_variables</a></li>
<li><a href="#L88">ngx_stream_variable_null_value</a></li>
<li><a href="#L90">ngx_stream_variable_true_value</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L95">ngx_stream_add_variable</a></li>
<li><a href="#L263">ngx_stream_get_flushed_variable</a></li>
<li><a href="#L226">ngx_stream_get_indexed_variable</a></li>
<li><a href="#L283">ngx_stream_get_variable</a></li>
<li><a href="#L166">ngx_stream_get_variable_index</a></li>
<li><a href="#L626">ngx_stream_map_find</a></li>
<li><a href="#L698">ngx_stream_regex_compile</a></li>
<li><a href="#L771">ngx_stream_regex_exec</a></li>
<li><a href="#L323">ngx_stream_variable_binary_remote_addr</a></li>
<li><a href="#L464">ngx_stream_variable_bytes_sent</a></li>
<li><a href="#L485">ngx_stream_variable_connection</a></li>
<li><a href="#L520">ngx_stream_variable_hostname</a></li>
<li><a href="#L555">ngx_stream_variable_msec</a></li>
<li><a href="#L506">ngx_stream_variable_nginx_version</a></li>
<li><a href="#L689">ngx_stream_variable_not_found</a></li>
<li><a href="#L534">ngx_stream_variable_pid</a></li>
<li><a href="#L363">ngx_stream_variable_remote_addr</a></li>
<li><a href="#L377">ngx_stream_variable_remote_port</a></li>
<li><a href="#L403">ngx_stream_variable_server_addr</a></li>
<li><a href="#L434">ngx_stream_variable_server_port</a></li>
<li><a href="#L579">ngx_stream_variable_time_iso8601</a></li>
<li><a href="#L603">ngx_stream_variable_time_local</a></li>
<li><a href="#L842">ngx_stream_variables_add_core_vars</a></li>
<li><a href="#L893">ngx_stream_variables_init_vars</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_stream.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;<a href="../http/modules/perl/ngx_http_perl_module.h.html#L21" title="src/http/modules/perl/ngx_http_perl_module.h:21">nginx</a>.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L323" title="src/stream/ngx_stream_variables.c:323">ngx_stream_variable_binary_remote_addr</a>(<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s, <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L363" title="src/stream/ngx_stream_variables.c:363">ngx_stream_variable_remote_addr</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L377" title="src/stream/ngx_stream_variables.c:377">ngx_stream_variable_remote_port</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L403" title="src/stream/ngx_stream_variables.c:403">ngx_stream_variable_server_addr</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L434" title="src/stream/ngx_stream_variables.c:434">ngx_stream_variable_server_port</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L464" title="src/stream/ngx_stream_variables.c:464">ngx_stream_variable_bytes_sent</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L485" title="src/stream/ngx_stream_variables.c:485">ngx_stream_variable_connection</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L506" title="src/stream/ngx_stream_variables.c:506">ngx_stream_variable_nginx_version</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L520" title="src/stream/ngx_stream_variables.c:520">ngx_stream_variable_hostname</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L534" title="src/stream/ngx_stream_variables.c:534">ngx_stream_variable_pid</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L555" title="src/stream/ngx_stream_variables.c:555">ngx_stream_variable_msec</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L579" title="src/stream/ngx_stream_variables.c:579">ngx_stream_variable_time_iso8601</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a> <a href="#L603" title="src/stream/ngx_stream_variables.c:603">ngx_stream_variable_time_local</a>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L43">&#x200c;</a><span class="Type">static</span> <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; <span class="linkable">ngx_stream_core_variables</span>[] = {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;binary_remote_addr&quot;</span>), <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L323" title="src/stream/ngx_stream_variables.c:323">ngx_stream_variable_binary_remote_addr</a>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;remote_addr&quot;</span>), <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L363" title="src/stream/ngx_stream_variables.c:363">ngx_stream_variable_remote_addr</a>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;remote_port&quot;</span>), <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L377" title="src/stream/ngx_stream_variables.c:377">ngx_stream_variable_remote_port</a>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;server_addr&quot;</span>), <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L403" title="src/stream/ngx_stream_variables.c:403">ngx_stream_variable_server_addr</a>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;server_port&quot;</span>), <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L434" title="src/stream/ngx_stream_variables.c:434">ngx_stream_variable_server_port</a>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;bytes_sent&quot;</span>), <span class="Constant">NULL</span>, <a href="#L464" title="src/stream/ngx_stream_variables.c:464">ngx_stream_variable_bytes_sent</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;connection&quot;</span>), <span class="Constant">NULL</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L485" title="src/stream/ngx_stream_variables.c:485">ngx_stream_variable_connection</a>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;<a href="../core/nginx.h.html#L12" title="src/core/nginx.h:12">nginx_version</a>&quot;</span>), <span class="Constant">NULL</span>, <a href="#L506" title="src/stream/ngx_stream_variables.c:506">ngx_stream_variable_nginx_version</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;hostname&quot;</span>), <span class="Constant">NULL</span>, <a href="#L520" title="src/stream/ngx_stream_variables.c:520">ngx_stream_variable_hostname</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;pid&quot;</span>), <span class="Constant">NULL</span>, <a href="#L534" title="src/stream/ngx_stream_variables.c:534">ngx_stream_variable_pid</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;<a href="../event/modules/ngx_iocp_module.c.html#L103" title="src/event/modules/ngx_iocp_module.c:103">msec</a>&quot;</span>), <span class="Constant">NULL</span>, <a href="#L555" title="src/stream/ngx_stream_variables.c:555">ngx_stream_variable_msec</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>, <a href="ngx_stream_variables.h.html#L30" title="src/stream/ngx_stream_variables.h:30">NGX_STREAM_VAR_NOCACHEABLE</a>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;time_iso8601&quot;</span>), <span class="Constant">NULL</span>, <a href="#L579" title="src/stream/ngx_stream_variables.c:579">ngx_stream_variable_time_iso8601</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>, <a href="ngx_stream_variables.h.html#L30" title="src/stream/ngx_stream_variables.h:30">NGX_STREAM_VAR_NOCACHEABLE</a>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L40" title="src/core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;time_local&quot;</span>), <span class="Constant">NULL</span>, <a href="#L603" title="src/stream/ngx_stream_variables.c:603">ngx_stream_variable_time_local</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>, <a href="ngx_stream_variables.h.html#L30" title="src/stream/ngx_stream_variables.h:30">NGX_STREAM_VAR_NOCACHEABLE</a>, <span class="Constant">0</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../core/ngx_string.h.html#L41" title="src/core/ngx_string.h:41">ngx_null_string</a>, <span class="Constant">NULL</span>, <span class="Constant">NULL</span>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">0</span> }<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L88">&#x200c;</a><a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a>&nbsp; <span class="linkable">ngx_stream_variable_null_value</span> =<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L19" title="src/stream/ngx_stream_variables.h:19">ngx_stream_variable</a>(<span class="Constant">&quot;&quot;</span>);<br/></li>
<li><a id="L90">&#x200c;</a><a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a>&nbsp; <span class="linkable">ngx_stream_variable_true_value</span> =<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L19" title="src/stream/ngx_stream_variables.h:19">ngx_stream_variable</a>(<span class="Constant">&quot;1&quot;</span>);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a> *<br/></li>
<li><a id="L95">&#x200c;</a><span class="linkable">ngx_stream_add_variable</span>(<a href="../core/ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *name, <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> flags)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L39" title="src/core/ngx_hash.h:39">ngx_hash_key_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *key;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (name-&gt;len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;invalid variable name </span><span class="Special">\&quot;</span><span class="Constant">$</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L206" title="src/stream/ngx_stream.h:206">ngx_stream_conf_get_module_main_conf</a>(cf, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; key = cmcf-&gt;variables_keys-&gt;keys.elts;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cmcf-&gt;variables_keys-&gt;keys.nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (name-&gt;len != key[i].key.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="../core/ngx_string.c.html#L597" title="src/core/ngx_string.c:597">ngx_strncasecmp</a>(name-&gt;data, key[i].key.data, name-&gt;len) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v = key[i].value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!(v-&gt;flags &amp; <a href="ngx_stream_variables.h.html#L29" title="src/stream/ngx_stream_variables.h:29">NGX_STREAM_VAR_CHANGEABLE</a>)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;the duplicate </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant"> variable&quot;</span>, name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> v;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = <a href="../core/ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(cf-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;name.len = name-&gt;len;<br/></li>
<li>&nbsp; &nbsp; v-&gt;name.data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(cf-&gt;pool, name-&gt;len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;name.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L21" title="src/core/ngx_string.c:21">ngx_strlow</a>(v-&gt;name.data, name-&gt;data, name-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;set_handler = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;get_handler = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;flags = flags;<br/></li>
<li>&nbsp; &nbsp; v-&gt;index = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = <a href="../core/ngx_hash.c.html#L714" title="src/core/ngx_hash.c:714">ngx_hash_add_key</a>(cmcf-&gt;variables_keys, &amp;v-&gt;name, v, <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L39" title="src/core/ngx_core.h:39">NGX_BUSY</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;conflicting variable name </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> v;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L166">&#x200c;</a><span class="linkable">ngx_stream_get_variable_index</span>(<a href="../core/ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *name)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (name-&gt;len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;invalid variable name </span><span class="Special">\&quot;</span><span class="Constant">$</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L206" title="src/stream/ngx_stream.h:206">ngx_stream_conf_get_module_main_conf</a>(cf, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = cmcf-&gt;variables.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_array.h.html#L32" title="src/core/ngx_array.h:32">ngx_array_init</a>(&amp;cmcf-&gt;variables, cf-&gt;pool, <span class="Constant">4</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cmcf-&gt;variables.nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (name-&gt;len != v[i].name.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || <a href="../core/ngx_string.c.html#L597" title="src/core/ngx_string.c:597">ngx_strncasecmp</a>(name-&gt;data, v[i].name.data, name-&gt;len) != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = <a href="../core/ngx_array.c.html#L48" title="src/core/ngx_array.c:48">ngx_array_push</a>(&amp;cmcf-&gt;variables);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;name.len = name-&gt;len;<br/></li>
<li>&nbsp; &nbsp; v-&gt;name.data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(cf-&gt;pool, name-&gt;len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;name.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L21" title="src/core/ngx_string.c:21">ngx_strlow</a>(v-&gt;name.data, name-&gt;data, name-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;set_handler = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;get_handler = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;flags = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;index = cmcf-&gt;variables.nelts - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> v-&gt;index;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *<br/></li>
<li><a id="L226">&#x200c;</a><span class="linkable">ngx_stream_get_indexed_variable</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s, <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> index)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L201" title="src/stream/ngx_stream.h:201">ngx_stream_get_module_main_conf</a>(s, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cmcf-&gt;variables.nelts &lt;= index) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="src/core/ngx_log.h:18">NGX_LOG_ALERT</a>, s-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;unknown variable index: </span><span class="Special">%u</span><span class="Constant">i&quot;</span>, index);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (s-&gt;variables[index].not_found || s-&gt;variables[index].valid) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> &amp;s-&gt;variables[index];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = cmcf-&gt;variables.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v[index].get_handler(s, &amp;s-&gt;variables[index], v[index].data)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; == <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v[index].flags &amp; <a href="ngx_stream_variables.h.html#L30" title="src/stream/ngx_stream_variables.h:30">NGX_STREAM_VAR_NOCACHEABLE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s-&gt;variables[index].no_cacheable = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> &amp;s-&gt;variables[index];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; s-&gt;variables[index].valid = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; s-&gt;variables[index].not_found = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *<br/></li>
<li><a id="L263">&#x200c;</a><span class="linkable">ngx_stream_get_flushed_variable</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s, <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> index)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a>&nbsp; *v;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = &amp;s-&gt;variables[index];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;valid || v-&gt;not_found) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!v-&gt;no_cacheable) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> v;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;valid = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L226" title="src/stream/ngx_stream_variables.c:226">ngx_stream_get_indexed_variable</a>(s, index);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *<br/></li>
<li><a id="L283">&#x200c;</a><span class="linkable">ngx_stream_get_variable</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s, <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *name,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a> key)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a>&nbsp; *vv;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L201" title="src/stream/ngx_stream.h:201">ngx_stream_get_module_main_conf</a>(s, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = <a href="../core/ngx_hash.c.html#L13" title="src/core/ngx_hash.c:13">ngx_hash_find</a>(&amp;cmcf-&gt;variables_hash, key, name-&gt;data, name-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;flags &amp; <a href="ngx_stream_variables.h.html#L31" title="src/stream/ngx_stream_variables.h:31">NGX_STREAM_VAR_INDEXED</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L263" title="src/stream/ngx_stream_variables.c:263">ngx_stream_get_flushed_variable</a>(s, v-&gt;index);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vv = <a href="../core/ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(s-&gt;connection-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a>));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (vv &amp;&amp; v-&gt;get_handler(s, vv, v-&gt;data) == <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> vv;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; vv = <a href="../core/ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(s-&gt;connection-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (vv == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; vv-&gt;not_found = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> vv;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L323">&#x200c;</a><span class="linkable">ngx_stream_variable_binary_remote_addr</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp;&nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li> {<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp;&nbsp; *sin;<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; *sin6;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (s-&gt;connection-&gt;sockaddr-&gt;sa_family) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin6 = (<span class="Type">struct</span> sockaddr_in6 *) s-&gt;connection-&gt;sockaddr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;len = <span class="Statement">sizeof</span>(<span class="Type">struct</span> in6_addr);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;data = sin6-&gt;sin6_addr.s6_addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Comment">/* AF_INET */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; sin = (<span class="Type">struct</span> sockaddr_in *) s-&gt;connection-&gt;sockaddr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;len = <span class="Statement">sizeof</span>(<a href="../os/win32/ngx_win32_config.h.html#L192" title="src/os/win32/ngx_win32_config.h:192">in_addr_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;data = (u_char *) &amp;sin-&gt;sin_addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L363">&#x200c;</a><span class="linkable">ngx_stream_variable_remote_addr</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; v-&gt;len = s-&gt;connection-&gt;addr_text.len;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = s-&gt;connection-&gt;addr_text.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L377">&#x200c;</a><span class="linkable">ngx_stream_variable_remote_port</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <span class="Statement">sizeof</span>(<span class="Constant">&quot;65535&quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; port = <a href="../core/ngx_inet.c.html#L1345" title="src/core/ngx_inet.c:1345">ngx_inet_get_port</a>(s-&gt;connection-&gt;sockaddr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (port &gt; <span class="Constant">0</span> &amp;&amp; port &lt; <span class="Constant">65536</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_string.c.html#L105" title="src/core/ngx_string.c:105">ngx_sprintf</a>(v-&gt;data, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, port) - v-&gt;data;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L403">&#x200c;</a><span class="linkable">ngx_stream_variable_server_addr</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; str;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp;&nbsp; addr[<a href="../core/ngx_inet.h.html#L23" title="src/core/ngx_inet.h:23">NGX_SOCKADDR_STRLEN</a>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; str.len = <a href="../core/ngx_inet.h.html#L23" title="src/core/ngx_inet.h:23">NGX_SOCKADDR_STRLEN</a>;<br/></li>
<li>&nbsp; &nbsp; str.data = addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_connection.c.html#L1276" title="src/core/ngx_connection.c:1276">ngx_connection_local_sockaddr</a>(s-&gt;connection, &amp;str, <span class="Constant">0</span>) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; str.data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, str.len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (str.data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1966" title="src/core/ngx_string.c:1966">ngx_memcpy</a>(str.data, addr, str.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = str.len;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = str.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L434">&#x200c;</a><span class="linkable">ngx_stream_variable_server_port</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_connection.c.html#L1276" title="src/core/ngx_connection.c:1276">ngx_connection_local_sockaddr</a>(s-&gt;connection, <span class="Constant">NULL</span>, <span class="Constant">0</span>) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;data = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <span class="Statement">sizeof</span>(<span class="Constant">&quot;65535&quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (v-&gt;data == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; port = <a href="../core/ngx_inet.c.html#L1345" title="src/core/ngx_inet.c:1345">ngx_inet_get_port</a>(s-&gt;connection-&gt;local_sockaddr);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (port &gt; <span class="Constant">0</span> &amp;&amp; port &lt; <span class="Constant">65536</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_string.c.html#L105" title="src/core/ngx_string.c:105">ngx_sprintf</a>(v-&gt;data, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">i&quot;</span>, port) - v-&gt;data;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L464">&#x200c;</a><span class="linkable">ngx_stream_variable_bytes_sent</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <a href="../os/win32/ngx_win32_config.h.html#L218" title="src/os/win32/ngx_win32_config.h:218">NGX_OFF_T_LEN</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_string.c.html#L105" title="src/core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;</span><span class="Special">%O</span><span class="Constant">&quot;</span>, s-&gt;connection-&gt;sent) - p;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L485">&#x200c;</a><span class="linkable">ngx_stream_variable_connection</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <a href="../os/win32/ngx_atomic.h.html#L21" title="src/os/win32/ngx_atomic.h:21">NGX_ATOMIC_T_LEN</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_string.c.html#L105" title="src/core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">A&quot;</span>, s-&gt;connection-&gt;number) - p;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L506">&#x200c;</a><span class="linkable">ngx_stream_variable_nginx_version</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <span class="Statement">sizeof</span>(<a href="../core/nginx.h.html#L13" title="src/core/nginx.h:13">NGINX_VERSION</a>) - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = (u_char *) <a href="../core/nginx.h.html#L13" title="src/core/nginx.h:13">NGINX_VERSION</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L520">&#x200c;</a><span class="linkable">ngx_stream_variable_hostname</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;hostname.len;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = <a href="../core/ngx_cycle.c.html#L20" title="src/core/ngx_cycle.c:20">ngx_cycle</a>-&gt;hostname.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L534">&#x200c;</a><span class="linkable">ngx_stream_variable_pid</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <a href="../core/ngx_config.h.html#L84" title="src/core/ngx_config.h:84">NGX_INT64_LEN</a>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_string.c.html#L105" title="src/core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;%P&quot;</span>, <a href="../os/win32/ngx_process_cycle.c.html#L33" title="src/os/win32/ngx_process_cycle.c:33">ngx_pid</a>) - p;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L555">&#x200c;</a><span class="linkable">ngx_stream_variable_msec</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_times.h.html#L20" title="src/core/ngx_times.h:20">ngx_time_t</a>&nbsp; *tp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <a href="../os/win32/ngx_win32_config.h.html#L202" title="src/os/win32/ngx_win32_config.h:202">NGX_TIME_T_LEN</a> + <span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; tp = <a href="../core/ngx_times.h.html#L37" title="src/core/ngx_times.h:37">ngx_timeofday</a>();<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_string.c.html#L105" title="src/core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;%T.%03M&quot;</span>, tp-&gt;sec, tp-&gt;<a href="../event/modules/ngx_iocp_module.c.html#L103" title="src/event/modules/ngx_iocp_module.c:103">msec</a>) - p;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L579">&#x200c;</a><span class="linkable">ngx_stream_variable_time_iso8601</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <a href="../core/ngx_times.c.html#L31" title="src/core/ngx_times.c:31">ngx_cached_http_log_iso8601</a>.len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1966" title="src/core/ngx_string.c:1966">ngx_memcpy</a>(p, <a href="../core/ngx_times.c.html#L31" title="src/core/ngx_times.c:31">ngx_cached_http_log_iso8601</a>.data,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="../core/ngx_times.c.html#L31" title="src/core/ngx_times.c:31">ngx_cached_http_log_iso8601</a>.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_times.c.html#L31" title="src/core/ngx_times.c:31">ngx_cached_http_log_iso8601</a>.len;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L603">&#x200c;</a><span class="linkable">ngx_stream_variable_time_local</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, <a href="../core/ngx_times.c.html#L30" title="src/core/ngx_times.c:30">ngx_cached_http_log_time</a>.len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.c.html#L1966" title="src/core/ngx_string.c:1966">ngx_memcpy</a>(p, <a href="../core/ngx_times.c.html#L30" title="src/core/ngx_times.c:30">ngx_cached_http_log_time</a>.data, <a href="../core/ngx_times.c.html#L30" title="src/core/ngx_times.c:30">ngx_cached_http_log_time</a>.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v-&gt;len = <a href="../core/ngx_times.c.html#L30" title="src/core/ngx_times.c:30">ngx_cached_http_log_time</a>.len;<br/></li>
<li>&nbsp; &nbsp; v-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; v-&gt;data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void</span> *<br/></li>
<li><a id="L626">&#x200c;</a><span class="linkable">ngx_stream_map_find</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s, <a href="ngx_stream_variables.h.html#L94" title="src/stream/ngx_stream_variables.h:94">ngx_stream_map_t</a> *map,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *match)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span>&nbsp; &nbsp; &nbsp; &nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; *low;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; key;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = match-&gt;len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; low = <a href="../core/ngx_palloc.c.html#L139" title="src/core/ngx_palloc.c:139">ngx_pnalloc</a>(s-&gt;connection-&gt;pool, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (low == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; low = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; key = <a href="../core/ngx_hash.c.html#L641" title="src/core/ngx_hash.c:641">ngx_hash_strlow</a>(low, match-&gt;data, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = <a href="../core/ngx_hash.c.html#L211" title="src/core/ngx_hash.c:211">ngx_hash_find_combined</a>(&amp;map-&gt;hash, key, low, len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_PCRE)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &amp;&amp; map-&gt;nregex) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L77" title="src/stream/ngx_stream_variables.h:77">ngx_stream_map_regex_t</a>&nbsp; *reg;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; reg = map-&gt;regex;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; map-&gt;nregex; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <a href="#L771" title="src/stream/ngx_stream_variables.c:771">ngx_stream_regex_exec</a>(s, reg[i].regex, match);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> reg[i].value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <a href="../core/ngx_core.h.html#L41" title="src/core/ngx_core.h:41">NGX_DECLINED</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a> */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_PCRE)<br/></li>
<li></span><br/></li>
<li><span class="Type">static</span> <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L689">&#x200c;</a><span class="linkable">ngx_stream_variable_not_found</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a> *v, <span class="Type"><a href="../os/win32/ngx_win32_config.h.html#L156" title="src/os/win32/ngx_win32_config.h:156">uintptr_t</a></span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; v-&gt;not_found = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_stream_variables.h.html#L71" title="src/stream/ngx_stream_variables.h:71">ngx_stream_regex_t</a> *<br/></li>
<li><a id="L698">&#x200c;</a><span class="linkable">ngx_stream_regex_compile</span>(<a href="../core/ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf, <a href="../core/ngx_regex.h.html#L40" title="src/core/ngx_regex.h:40">ngx_regex_compile_t</a> *rc)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; name;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i, n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L71" title="src/stream/ngx_stream_variables.h:71">ngx_stream_regex_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *re;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L62" title="src/stream/ngx_stream_variables.h:62">ngx_stream_regex_variable_t</a>&nbsp; *rv;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc-&gt;pool = cf-&gt;pool;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_regex.c.html#L95" title="src/core/ngx_regex.c:95">ngx_regex_compile</a>(rc) != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>, <span class="Constant">&quot;%V&quot;</span>, &amp;rc-&gt;err);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; re = <a href="../core/ngx_palloc.c.html#L301" title="src/core/ngx_palloc.c:301">ngx_pcalloc</a>(cf-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_stream_variables.h.html#L71" title="src/stream/ngx_stream_variables.h:71">ngx_stream_regex_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (re == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; re-&gt;regex = rc-&gt;regex;<br/></li>
<li>&nbsp; &nbsp; re-&gt;ncaptures = rc-&gt;captures;<br/></li>
<li>&nbsp; &nbsp; re-&gt;name = rc-&gt;pattern;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L206" title="src/stream/ngx_stream.h:206">ngx_stream_conf_get_module_main_conf</a>(cf, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li>&nbsp; &nbsp; cmcf-&gt;ncaptures = <a href="../core/ngx_core.h.html#L101" title="src/core/ngx_core.h:101">ngx_max</a>(cmcf-&gt;ncaptures, re-&gt;ncaptures);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = (<a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>) rc-&gt;named_captures;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> re;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rv = <a href="../core/ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(rc-&gt;pool, n * <span class="Statement">sizeof</span>(<a href="ngx_stream_variables.h.html#L62" title="src/stream/ngx_stream_variables.h:62">ngx_stream_regex_variable_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rv == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; re-&gt;variables = rv;<br/></li>
<li>&nbsp; &nbsp; re-&gt;nvariables = n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; size = rc-&gt;name_size;<br/></li>
<li>&nbsp; &nbsp; p = rc-&gt;names;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rv[i].capture = <span class="Constant">2</span> * ((p[<span class="Constant">0</span>] &lt;&lt; <span class="Constant">8</span>) + p[<span class="Constant">1</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; name.data = &amp;p[<span class="Constant">2</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; name.len = <a href="../core/ngx_string.h.html#L61" title="src/core/ngx_string.h:61">ngx_strlen</a>(name.data);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v = <a href="#L95" title="src/stream/ngx_stream_variables.c:95">ngx_stream_add_variable</a>(cf, &amp;name, <a href="ngx_stream_variables.h.html#L29" title="src/stream/ngx_stream_variables.h:29">NGX_STREAM_VAR_CHANGEABLE</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rv[i].index = <a href="#L166" title="src/stream/ngx_stream_variables.c:166">ngx_stream_get_variable_index</a>(cf, &amp;name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rv[i].index == <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;get_handler = <a href="#L689" title="src/stream/ngx_stream_variables.c:689">ngx_stream_variable_not_found</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p += size;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> re;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L771">&#x200c;</a><span class="linkable">ngx_stream_regex_exec</span>(<a href="ngx_stream.h.html#L20" title="src/stream/ngx_stream.h:20">ngx_stream_session_t</a> *s, <a href="ngx_stream_variables.h.html#L71" title="src/stream/ngx_stream_variables.h:71">ngx_stream_regex_t</a> *re,<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_string.h.html#L19" title="src/core/ngx_string.h:19">ngx_str_t</a> *str)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rc, index;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i, n, len;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L17" title="src/stream/ngx_stream_variables.h:17">ngx_stream_variable_value_t</a>&nbsp; *vv;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L201" title="src/stream/ngx_stream.h:201">ngx_stream_get_module_main_conf</a>(s, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (re-&gt;ncaptures) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = cmcf-&gt;ncaptures;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s-&gt;captures == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s-&gt;captures = <a href="../core/ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(s-&gt;connection-&gt;pool, len * <span class="Statement">sizeof</span>(<span class="Type">int</span>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s-&gt;captures == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = <a href="../core/ngx_regex.h.html#L52" title="src/core/ngx_regex.h:52">ngx_regex_exec</a>(re-&gt;regex, str, s-&gt;captures, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_regex.h.html#L18" title="src/core/ngx_regex.h:18">NGX_REGEX_NO_MATCHED</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L41" title="src/core/ngx_core.h:41">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (rc &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L18" title="src/core/ngx_log.h:18">NGX_LOG_ALERT</a>, s-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_regex.h.html#L55" title="src/core/ngx_regex.h:55">ngx_regex_exec_n</a> <span class="Constant">&quot; failed: </span><span class="Special">%i</span><span class="Constant"> on </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant"> using </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc, str, &amp;re-&gt;name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; re-&gt;nvariables; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = re-&gt;variables[i].capture;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; index = re-&gt;variables[i].index;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; vv = &amp;s-&gt;variables[index];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; vv-&gt;len = s-&gt;captures[n + <span class="Constant">1</span>] - s-&gt;captures[n];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; vv-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; vv-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; vv-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; vv-&gt;data = &amp;str-&gt;data[s-&gt;captures[n]];<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_DEBUG)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; *v;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v = cmcf-&gt;variables.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.h.html#L142" title="src/core/ngx_log.h:142">ngx_log_debug2</a>(<a href="../core/ngx_log.h.html#L32" title="src/core/ngx_log.h:32">NGX_LOG_DEBUG_STREAM</a>, s-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;stream regex set $%V to </span><span class="Special">\&quot;</span><span class="Constant">%v</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;v[index].name, vv);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; s-&gt;ncaptures = rc * <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; s-&gt;captures_data = str-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L842">&#x200c;</a><span class="linkable">ngx_stream_variables_add_core_vars</span>(<a href="../core/ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *cv, *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L206" title="src/stream/ngx_stream.h:206">ngx_stream_conf_get_module_main_conf</a>(cf, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf-&gt;variables_keys = <a href="../core/ngx_palloc.c.html#L301" title="src/core/ngx_palloc.c:301">ngx_pcalloc</a>(cf-&gt;temp_pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="../core/ngx_hash.h.html#L89" title="src/core/ngx_hash.h:89">ngx_hash_keys_arrays_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cmcf-&gt;variables_keys == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf-&gt;variables_keys-&gt;pool = cf-&gt;pool;<br/></li>
<li>&nbsp; &nbsp; cmcf-&gt;variables_keys-&gt;temp_pool = cf-&gt;pool;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_hash.c.html#L659" title="src/core/ngx_hash.c:659">ngx_hash_keys_array_init</a>(cmcf-&gt;variables_keys, <a href="../core/ngx_hash.h.html#L65" title="src/core/ngx_hash.h:65">NGX_HASH_SMALL</a>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (cv = <a href="#L43" title="src/stream/ngx_stream_variables.c:43">ngx_stream_core_variables</a>; cv-&gt;name.len; cv++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v = <a href="../core/ngx_palloc.c.html#L126" title="src/core/ngx_palloc.c:126">ngx_palloc</a>(cf-&gt;pool, <span class="Statement">sizeof</span>(<a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *v = *cv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="../core/ngx_hash.c.html#L714" title="src/core/ngx_hash.c:714">ngx_hash_add_key</a>(cmcf-&gt;variables_keys, &amp;v-&gt;name, v,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L72" title="src/core/ngx_hash.h:72">NGX_HASH_READONLY_KEY</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc == <a href="../core/ngx_core.h.html#L39" title="src/core/ngx_core.h:39">NGX_BUSY</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_conf_file.c.html#L950" title="src/core/ngx_conf_file.c:950">ngx_conf_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;conflicting variable name </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;v-&gt;name);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="../core/ngx_config.h.html#L78" title="src/core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L893">&#x200c;</a><span class="linkable">ngx_stream_variables_init_vars</span>(<a href="../core/ngx_core.h.html#L16" title="src/core/ngx_core.h:16">ngx_conf_t</a> *cf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_config.h.html#L79" title="src/core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i, n;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L39" title="src/core/ngx_hash.h:39">ngx_hash_key_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *key;<br/></li>
<li>&nbsp; &nbsp; <a href="../core/ngx_hash.h.html#L62" title="src/core/ngx_hash.h:62">ngx_hash_init_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hash;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream_variables.h.html#L21" title="src/stream/ngx_stream_variables.h:21">ngx_stream_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; *v, *av;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_stream.h.html#L127" title="src/stream/ngx_stream.h:127">ngx_stream_core_main_conf_t</a>&nbsp; *cmcf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* set the handlers for the indexed stream variables */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; cmcf = <a href="ngx_stream.h.html#L206" title="src/stream/ngx_stream.h:206">ngx_stream_conf_get_module_main_conf</a>(cf, <a href="ngx_stream_core_module.c.html#L87" title="src/stream/ngx_stream_core_module.c:87">ngx_stream_core_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; v = cmcf-&gt;variables.elts;<br/></li>
<li>&nbsp; &nbsp; key = cmcf-&gt;variables_keys-&gt;keys.elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cmcf-&gt;variables.nelts; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (n = <span class="Constant">0</span>; n &lt; cmcf-&gt;variables_keys-&gt;keys.nelts; n++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; av = key[n].value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v[i].name.len == key[n].key.len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <a href="../core/ngx_string.h.html#L53" title="src/core/ngx_string.h:53">ngx_strncmp</a>(v[i].name.data, key[n].key.data, v[i].name.len)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; == <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v[i].get_handler = av-&gt;get_handler;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v[i].data = av-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; av-&gt;flags |= <a href="ngx_stream_variables.h.html#L31" title="src/stream/ngx_stream_variables.h:31">NGX_STREAM_VAR_INDEXED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v[i].flags = av-&gt;flags;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; av-&gt;index = i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (av-&gt;get_handler == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> next;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../core/ngx_log.c.html#L216" title="src/core/ngx_log.c:216">ngx_log_error</a>(<a href="../core/ngx_log.h.html#L17" title="src/core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;unknown </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant"> variable&quot;</span>, &amp;v[i].name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">next</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (n = <span class="Constant">0</span>; n &lt; cmcf-&gt;variables_keys-&gt;keys.nelts; n++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; av = key[n].value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (av-&gt;flags &amp; <a href="ngx_stream_variables.h.html#L32" title="src/stream/ngx_stream_variables.h:32">NGX_STREAM_VAR_NOHASH</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; key[n].key.data = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; hash.hash = &amp;cmcf-&gt;variables_hash;<br/></li>
<li>&nbsp; &nbsp; hash.key = <a href="../core/ngx_hash.c.html#L611" title="src/core/ngx_hash.c:611">ngx_hash_key</a>;<br/></li>
<li>&nbsp; &nbsp; hash.max_size = cmcf-&gt;variables_hash_max_size;<br/></li>
<li>&nbsp; &nbsp; hash.bucket_size = cmcf-&gt;variables_hash_bucket_size;<br/></li>
<li>&nbsp; &nbsp; hash.name = <span class="Constant">&quot;variables_hash&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; hash.pool = cf-&gt;pool;<br/></li>
<li>&nbsp; &nbsp; hash.temp_pool = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="../core/ngx_hash.c.html#L252" title="src/core/ngx_hash.c:252">ngx_hash_init</a>(&amp;hash, cmcf-&gt;variables_keys-&gt;keys.elts,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmcf-&gt;variables_keys-&gt;keys.nelts)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; != <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L37" title="src/core/ngx_core.h:37">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cmcf-&gt;variables_keys = <span class="Constant">NULL</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../core/ngx_core.h.html#L36" title="src/core/ngx_core.h:36">NGX_OK</a>;<br/></li>
<li>}<br/></li>
</ol></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
